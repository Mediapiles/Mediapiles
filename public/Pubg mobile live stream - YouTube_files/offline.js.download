(function(g){var window=this;'use strict';var VZh=function(D){var X=new g.yf("und",new g.yy("Default","und",!0));X.captionTracks=D.captionTracks;return X},$hC=function(D){return new g.yw(function(X,M){var Q=D.length,h=[];
if(Q)for(var H=function(T,L){Q--;h[T]=L;Q==0&&X(h)},t=function(T){M(T)},q,w=0;w<D.length;w++)q=D[w],g.s52(q,g.oa(H,w),t);
else X(h)})},vV=function(D){this.S=D},dG=function(){vV.apply(this,arguments)},BQ8=function(){dG.apply(this,arguments)},Z1h=function(){dG.apply(this,arguments)},Uhh=function(){dG.apply(this,arguments)},cKr=function(){dG.apply(this,arguments)},fXB=function(){dG.apply(this,arguments)},SUa=function(){dG.apply(this,arguments)},EXC=function(){dG.apply(this,arguments)},yKa=function(){vV.apply(this,arguments)},PgW=function(){dG.apply(this,arguments)},mh8=function(){dG.apply(this,arguments)},nXa=function(){dG.apply(this,
arguments)},b1y=function(){dG.apply(this,arguments)},e88=function(){dG.apply(this,arguments)},R8a=function(){dG.apply(this,arguments)},IXt=function(){dG.apply(this,arguments)},gXb=function(){dG.apply(this,arguments)},vXh=function(){dG.apply(this,arguments)},dhZ=function(){dG.apply(this,arguments)},rKK=function(){dG.apply(this,arguments)},i1h=function(){dG.apply(this,arguments)},oXC=function(){vV.apply(this,arguments)},CgG=function(){dG.apply(this,arguments)},O1h=function(){dG.apply(this,arguments)},
phG=function(){dG.apply(this,arguments)},AKK=function(){dG.apply(this,arguments)},YUh=function(){dG.apply(this,arguments)},lXK=function(){dG.apply(this,arguments)},JKh=function(){dG.apply(this,arguments)},xhy=function(){dG.apply(this,arguments)},Wyh=function(){dG.apply(this,arguments)},GXb=function(){vV.apply(this,arguments)},z8B=function(){vV.apply(this,arguments)},kXZ=function(){vV.apply(this,arguments)},umG=function(){dG.apply(this,arguments)},jqZ=function(){dG.apply(this,arguments)},Dga=function(){dG.apply(this,
arguments)},XRn=function(){dG.apply(this,arguments)},MjZ=function(){dG.apply(this,arguments)},Q5K=function(){dG.apply(this,arguments)},hA_=function(){dG.apply(this,arguments)},HJZ=function(){dG.apply(this,arguments)},tjb=function(){dG.apply(this,arguments)},Nin=function(){dG.apply(this,arguments)},qS8=function(){dG.apply(this,arguments)},wRr=function(){dG.apply(this,arguments)},TiB=function(){dG.apply(this,arguments)},LJr=function(){dG.apply(this,arguments)},s5b=function(){dG.apply(this,arguments)},
KJW=function(){dG.apply(this,arguments)},aOt=function(){dG.apply(this,arguments)},FJ8=function(){dG.apply(this,arguments)},VjG=function(){dG.apply(this,arguments)},$ga=function(){dG.apply(this,arguments)},BiK=function(){dG.apply(this,arguments)},ZJ_=function(){dG.apply(this,arguments)},UgB=function(){dG.apply(this,arguments)},cTB=function(){dG.apply(this,arguments)},fOB=function(){dG.apply(this,arguments)},SSC=function(){dG.apply(this,arguments)},Ecr=function(){dG.apply(this,arguments)},yTB=function(){dG.apply(this,
arguments)},PFC=function(){dG.apply(this,arguments)},mgC=function(){vV.apply(this,arguments)},nch=function(){dG.apply(this,arguments)},bJh=function(){dG.apply(this,arguments)},eAZ=function(){dG.apply(this,arguments)},RAn=function(){dG.apply(this,arguments)},IO8=function(){dG.apply(this,arguments)},gcG=function(){dG.apply(this,arguments)},vcn=function(){dG.apply(this,arguments)},dg8=function(){dG.apply(this,arguments)},rTh=function(){dG.apply(this,arguments)},iJa=function(){dG.apply(this,arguments)},
ocb=function(){dG.apply(this,arguments)},CFZ=function(){dG.apply(this,arguments)},OJB=function(){dG.apply(this,arguments)},pRG=function(){dG.apply(this,arguments)},ATZ=function(){dG.apply(this,arguments)},YSy=function(){dG.apply(this,arguments)},lOr=function(){dG.apply(this,arguments)},JTW=function(){dG.apply(this,arguments)},xgZ=function(){dG.apply(this,arguments)},WJn=function(){dG.apply(this,arguments)},GEB=function(){dG.apply(this,arguments)},zAB=function(){dG.apply(this,arguments)},kEh=function(){dG.apply(this,
arguments)},uab=function(){dG.apply(this,arguments)},j5_=function(){dG.apply(this,arguments)},DoB=function(){dG.apply(this,arguments)},XWh=function(){dG.apply(this,arguments)},Mi_=function(){dG.apply(this,arguments)},Qmr=function(){dG.apply(this,arguments)},hdt=function(){dG.apply(this,arguments)},Hph=function(){dG.apply(this,arguments)},tin=function(){dG.apply(this,arguments)},Nyt=function(){dG.apply(this,arguments)},qXn=function(){dG.apply(this,arguments)},wWh=function(D){D=D.key||D.id;
if(!D)throw Error("Entity key is missing");return D},Ty8=function(){if(rG)return rG();
var D={};rG=g.uD("PersistentEntityStoreDb",{Af:(D.EntityStore={kE:1},D.EntityAssociationStore={kE:2},D),shared:!1,upgrade:function(X,M){M(1)&&g.Rh(g.yu(X,"EntityStore",{keyPath:"key"}),"entityType","entityType");M(2)&&(X=g.yu(X,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Rh(X,"byParentEntityKey","parentEntityKey"),g.Rh(X,"byChildEntityKey","childEntityKey"))},
version:3});return rG()},Lrt=function(D){return g.Ci(Ty8(),D)},smW=function(D){return g.Ci((0,g.d_r)(),D)},iV=function(D){this.token=D},oV=function(D,X){X=X===void 0?{}:X;
g.ys.call(this,g.rhr[D],Object.assign({},{name:"PESEncoderError",type:D},X));this.type=D;this.level="WARNING";Object.setPrototypeOf(this,oV.prototype)},Kry=function(D){return new oV("WRONG_DATA_TYPE",{Tk:D})},aLn=function(D){return D instanceof Error?new oV("UNKNOWN_ENCODE_ERROR",{originalMessage:D.message}):new oV("UNKNOWN_ENCODE_ERROR")},Frr=function(D){return D instanceof Error?new oV("UNKNOWN_DECODE_ERROR",{originalMessage:D.message}):new oV("UNKNOWN_DECODE_ERROR")},Viy=function(D,X){D=D instanceof
oV?D:X(D);
g.ET(D);throw D;},$oG=function(){},Byh=function(D,X,M){try{return D.Y(X,M)}catch(Q){Viy(Q,aLn)}},ZpG=function(D){D=(new TextEncoder).encode(D).subarray(0,16);
var X=new Uint8Array(16);X.set(D);return X},Ch=function(D){this.S=D},cL_=function(D){var X=Uo_[D];
if(X)return X;g.P3(new g.ys("Entity model not found.",{entityType:D}))},fLr=function(D,X){this.S=D;
this.G=X;this.Y={}},EGa=function(D,X){a:{D=SX8(D.G,X.version);
try{var M=D.G(X.data,X.key);break a}catch(Q){Viy(Q,Frr)}M=void 0}return M},OR=function(D,X,M){return D.S.objectStore("EntityStore").get(X).then(function(Q){if(Q){if(M&&Q.entityType!==M)throw Error("Incorrect entity type");
return EGa(D,Q)}})},ph=function(D,X,M){return M?(M=M.map(function(Q){return OR(D,Q,X)}),g.Bc.all(M)):D.S.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(X)).then(function(Q){return Q.map(function(h){return EGa(D,h)})})},Yh=function(D,X,M){var Q=wWh(X),h=SX8(D.G,1),H=Object.assign({},X);
return D.S.objectStore("EntityStore").get(Q).then(function(t){if(t){if(t.entityType!==M)throw Error("Incorrect entity type");H.entityMetadata||(t=EGa(D,t),H.entityMetadata=t.entityMetadata)}}).then(function(){var t={key:Q,
entityType:M,data:Byh(h,H,Q),version:1};return g.Bc.all([g.ni(D.S.objectStore("EntityStore"),t),yLt(D,H,M)])}).then(function(){AJ(D,Q,M);
return Q})},PGW=function(D,X,M){X=X.map(function(Q){return Yh(D,Q,M)});
return g.Bc.all(X)},lV=function(D,X,M){if(M==null?0:M.wX){var Q=new Set;
return moa(D,X,Q).then(function(){for(var H=[],t=g.e(Q),q=t.next();!q.done;q=t.next())H.push(lV(D,q.value));return g.Bc.all(H).then(function(){})})}var h=g.il(X).entityType;
return g.Bc.all([D.S.objectStore("EntityStore").delete(X),nGn(D,X)]).then(function(){AJ(D,X,h)})},bpr=function(D,X){return g.dv(D.S.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(X)},function(M){return g.Bc.all([M.delete(),
nGn(D,M.cursor.primaryKey)]).then(function(){AJ(D,M.cursor.primaryKey,X);return g.gv(M)})})},edn=function(D,X,M,Q){var h=SX8(D.G,1);
return OR(D,X,Q).then(function(H){if(H){H=g.MG(H,M);var t={key:X,entityType:Q,data:Byh(h,H,X),version:1};return g.Bc.all([g.ni(D.S.objectStore("EntityStore"),t),yLt(D,H,Q)])}}).then(function(){AJ(D,X,Q);
return X})},AJ=function(D,X,M){var Q=D.Y[M];
Q||(Q=new Set,D.Y[M]=Q);Q.add(X)},Rdy=function(D,X,M){var Q=wWh(X);
M=cL_(M);if(!M)return g.Bc.resolve([]);M=new M(X);D=D.S.objectStore("EntityAssociationStore");X=[];M=g.e(M.G());for(var h=M.next();!h.done;h=M.next())X.push(g.ni(D,{parentEntityKey:Q,childEntityKey:h.value}));return g.Bc.all(X).then(function(H){return H.map(function(t){return t[1]})})},nGn=function(D,X){return D.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(X))},yLt=function(D,X,M){var Q=wWh(X);
return nGn(D,Q).then(function(){return Rdy(D,X,M)})},moa=function(D,X,M){if(M.has(X))return g.Bc.resolve(void 0);
M.add(X);return IL_(D,X).then(function(Q){return D.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(X)).then(function(){return Q})}).then(function(Q){var h=g.Bc.resolve(void 0);
Q=g.e(Q);for(var H=Q.next(),t={};!H.done;t={gb:void 0},H=Q.next())t.gb=H.value,h=h.then(function(q){return function(){return moa(D,q.gb,M)}}(t));
return h}).then(function(){})},IL_=function(D,X){var M=D.S.objectStore("EntityAssociationStore");
return M.index("byParentEntityKey").getAll(IDBKeyRange.only(X)).then(function(Q){var h=[];Q=g.e(Q);for(var H=Q.next();!H.done;H=Q.next())H=H.value,h.push(M.index("byChildEntityKey").getAll(H.childEntityKey));return g.Bc.all(h)}).then(function(Q){var h=[];
Q=g.e(Q);for(var H=Q.next();!H.done;H=Q.next())H=H.value,H.length===1&&h.push(H[0].childEntityKey);return h})},JJ=function(){},gGK=function(){this.S={};
this.S[0]=new JJ;if(!g.cX("aes_pes_encoder_killswitch")){var D=this.S;try{var X=g.Jr();var M=ZpG(X);var Q=new Ch(new g.je(M),new g.DU(M))}catch(h){throw D=h instanceof Error?new oV("KEY_CREATION_FAILED",{originalMessage:h.message}):new oV("KEY_CREATION_FAILED"),g.ET(D),D;}D[1]=Q}},SX8=function(D,X){X=X===void 0?0:X;
D=D.S[X];if(!D)throw X=new oV("INVALID_ENCODER_VERSION",{Tk:X}),g.ET(X),X;return D},xh=function(D,X){g.O.call(this);
this.token=D;this.S=X;this.observers=[];D=new g.E8.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Jr());D.onmessage=this.G.bind(this);this.channel=D},WV=function(D,X,M){var Q,h,H,t;
return g.r(function(q){if(q.S==1)return g.I(q,Lrt(D.token),2);if(q.S!=3)return Q=q.G,g.I(q,g.mt(Q,["EntityStore","EntityAssociationStore"],X,function(w){h=new fLr(w,D.S);return M(h)}),3);
H=q.G;h&&(t=h.Y,Object.keys(t).length>0&&(D.channel.postMessage(t),vGb(D,t)));return q.return(H)})},Gs=function(D,X,M){return WV(D,{mode:"readwrite",
d3:!0},function(Q){return Yh(Q,X,M)})},doy=function(D,X){return WV(D,{mode:"readwrite",
d3:!0},function(M){return PGW(M,X,"offlineOrchestrationActionWrapperEntity")})},rL8=function(D,X){return WV(D,{mode:"readwrite",
d3:!0},function(M){return lV(M,X)})},ipK=function(D){return WV(D,{mode:"readwrite",
d3:!0},function(X){return bpr(X,"videoPlaybackPositionEntity")})},zs=function(D,X,M){return WV(D,{mode:"readonly",
d3:!0},function(Q){return OR(Q,X,M)})},kh=function(D,X,M){return WV(D,{mode:"readonly",
d3:!0},function(Q){return ph(Q,X,M)})},vGb=function(D,X){D=g.e(D.observers);
for(var M=D.next();!M.done;M=D.next())M=M.value,M(X)},oG8=function(){var D,X,M;
return g.r(function(Q){if(Q.S==1)return g.N_(Q,2),g.I(Q,g.zh(),4);if(Q.S!=2){D=Q.G;if(!D||!g.xg()||typeof g.E8.BroadcastChannel==="undefined")return Q.return();X=new gGK;return Q.return(new xh(D,X))}M=g.LG(Q);M instanceof Error&&g.ET(M);return Q.return()})},uV=function(){CGy||(CGy=oG8());
return CGy},Op_=function(D){var X;
D=(X=D.options)==null?void 0:X.persistenceOption;return D==="ENTITY_PERSISTENCE_OPTION_PERSIST"||D==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},pWr=function(D){var X;
return g.r(function(M){return M.S==1?g.I(M,uV(),2):(X=M.G)?g.I(M,WV(X,"readwrite",function(Q){for(var h={},H=g.e(D),t=H.next(),q={};!t.done;q={uf:void 0,xz:void 0},t=H.next())q.uf=t.value,q.uf.entityKey&&Op_(q.uf)&&(q.xz=g.Sf(q.uf.payload),t=void 0,q.uf.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(t=function(w){return function(){return Yh(Q,w.uf.payload[w.xz],w.xz)}}(q)),q.uf.type==="ENTITY_MUTATION_TYPE_DELETE"&&(t=function(w){return function(){return lV(Q,w.uf.entityKey)}}(q)),q.uf.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(t=function(w){return function(){return edn(Q,w.uf.entityKey,w.uf.payload[w.xz],w.xz)}}(q)),t&&(h[q.uf.entityKey]=h[q.uf.entityKey]?h[q.uf.entityKey].then(t):t()));
return g.Bc.all(Object.values(h))}),0):M.return()})},ALa=function(D){var X;
return g.r(function(M){if(M.S==1){X=D.mutations;if(!X||X.length<=0)return M.return();if(g.tu){var Q={type:"ENTITY_LOADED"};X!==void 0&&(Q.payload=X);g.tu.dispatch(Q)}return g.I(M,pWr(X),2)}X.length=0;g.HZ(M)})},YXr=function(D){return D!==void 0},lLC=function(D){var X=g.gs();
X=Object.assign({},X);D=Object.assign({},D);for(var M in X)D[M]?(X[M]!==4&&(X[M]=D[M]),delete D[M]):X[M]!==2&&(X[M]=4);Object.assign(X,D);g.wxs(X);JSON.stringify(X);return X},JL8=function(D){var X,M;
return g.r(function(Q){if(Q.S==1)return g.I(Q,g.zh(),2);if(Q.S!=3)return(X=Q.G)?g.I(Q,g.rs(X),3):Q.return();M=Q.G;return Q.return(g.mt(M,["index","media","captions"],{mode:"readwrite",d3:!0},function(h){var H=IDBKeyRange.bound(D+"|",D+"~");h=[h.objectStore("index").delete(H),h.objectStore("media").delete(H),h.objectStore("captions").delete(H)];return g.Bc.all(h).then(function(){})}))})},xon=function(){var D,X;
return g.r(function(M){if(M.S==1)return g.I(M,g.zh(),2);if(M.S!=3){D=M.G;if(!D)throw g.Vu("rvdfd");return g.I(M,g.rs(D),3)}X=M.G;return M.return(g.mt(X,["index","media"],{mode:"readwrite",d3:!0},function(Q){var h={};return g.Ih(Q.objectStore("index"),{},function(H){var t=H.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),q=g.Bc.resolve(void 0);if(t){var w=t[1];t=t[2];h[w]=h[w]||{};var T;h[w][t]=g.ahW((T=H.getValue())==null?void 0:T.fmts)}else q=H.delete().then(function(){});
return g.Bc.all([g.gv(H),q]).then(function(L){return g.e(L).next().value})}).then(function(){for(var H={},t=g.e(Object.keys(h)),q=t.next();!q.done;q=t.next()){q=q.value;
var w=h[q].v;H[q]=h[q].a&&w?1:2}var T=lLC(H);return g.M9p(Q.objectStore("media"),{},function(L){var K=L.cursor.key.match(g.BDs);K&&H[K[1]]||Q.objectStore("media").delete(L.cursor.key);return g.x6m(L)}).then(function(){return T})})}))})},WrC=function(D,X){var M,Q;
return g.r(function(h){if(h.S==1)return g.I(h,g.zh(),2);if(h.S!=3){M=h.G;if(!M)throw g.Vu("wct");return g.I(h,g.rs(M),3)}Q=h.G;return g.I(h,g.mt(Q,["captions"],{mode:"readwrite",d3:!0},function(H){var t=[];H=H.objectStore("captions");for(var q=0;q<X.length;q++){var w=g.ni(H,X[q],D+"|"+X[q].metadata.vss_id);t.push(w)}return g.Bc.all(t)}),0)})},Gk_=function(D){var X,M,Q;
return g.r(function(h){if(h.S==1)return X=IDBKeyRange.bound(D+"|",D+"~"),g.I(h,g.zh(),2);if(h.S!=3){M=h.G;if(!M)throw g.Vu("gactfv");return g.I(h,g.rs(M),3)}Q=h.G;return h.return(Q.getAll("captions",X))})},zdb=function(D){return g.r(function(X){g.ds(D,0);
return X.return(JL8(D))})},kk8=function(D){return{context:g.Jq(),
videoIds:D}},u0G=function(D){return{context:g.Jq(),
playlistIds:D}},jmC=function(D){return{context:g.Jq(),
offlinePlaylistSyncChecks:D}},Dbh=function(){this.S=new Map},MnC=function(){XSC||(XSC=new Dbh);
return XSC},Qcy=function(D,X){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:D},metadata:X,statusCode:void 0,csn:void 0,can:void 0}},hiK=function(D,X,M){if(!M){var Q=Q===void 0?!1:Q;
M=D.S.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!M||Q)M=g.sB(16),D.S.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",M)}D={flowNonce:M,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:X.eventType};X.metadata&&(D.flowMetadata=X.metadata);X.statusCode!==void 0&&(D.flowEventStatus=X.statusCode);X.csn&&(D.csn=X.csn);X.can&&(D.can=X.can);g.Tm("flowEvent",D,void 0)},HPy=function(D){var X,M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs,S2,XC,q_,th,Jd,Gp,zy,Ra,m,$B,WZ,wR;
return g.r(function(eb){if(eb.S==1)return g.I(eb,WV(D,{mode:"readonly",d3:!0},function(E){return ph(E,"playbackData").then(function(Xn){var ci=Xn.map(function(zp){return zp.transfer}).filter(function(zp){return!!zp}),qu=Xn.map(function(zp){return zp.offlineVideoPolicy}).filter(function(zp){return!!zp}),Wi=Xn.filter(function(zp){return!!zp.key}).map(function(zp){return g.oL(g.il(zp.key).entityId,"downloadStatusEntity")});
ci=ph(E,"transfer",ci);qu=ph(E,"offlineVideoPolicy",qu);Wi=ph(E,"downloadStatusEntity",Wi);var wS=ci.then(function(zp){zp=zp.reduce(function(Dt,Pi){(Pi==null?0:Pi.offlineVideoStreams)&&Dt.push.apply(Dt,g.xW(Pi.offlineVideoStreams));return Dt},[]).filter(function(Dt){return!!Dt});
return ph(E,"offlineVideoStreams",zp)});
return g.Bc.all([ci,qu,wS,Wi]).then(function(zp){var Dt=g.e(zp);zp=Dt.next().value;var Pi=Dt.next().value;var P=Dt.next().value;Dt=Dt.next().value;return[Xn,zp,Pi,P,Dt]})})}),2);
if(eb.S!=3)return X=eb.G,g.I(eb,WV(D,{mode:"readonly",d3:!0},function(E){return ph(E,"mainDownloadsListEntity").then(function(Xn){var ci,qu;return(qu=(ci=Xn[0])==null?void 0:ci.downloads)!=null?qu:[]})}),3);
M=eb.G;Q=g.e(X);h=Q.next().value;H=Q.next().value;t=Q.next().value;q=Q.next().value;w=Q.next().value;T=h;L=H;K=t;a=q;F=w;V={};c={};S={};b={};n={};R=[];v=g.e(L);for(l=v.next();!l.done;l=v.next())(A=l.value)&&(V[A.key]=A);Hs=g.e(K);for(u=Hs.next();!u.done;u=Hs.next())(D_=u.value)&&(c[D_.key]=D_);q5=g.e(F);for(Lo=q5.next();!Lo.done;Lo=q5.next())(Qs=Lo.value)&&(S[Qs.key]=Qs);S2=g.e(a);for(XC=S2.next();!XC.done;XC=S2.next())(q_=XC.value)&&(b[q_.key]=q_);th=g.e(M);for(Jd=th.next();!Jd.done;Jd=th.next())Gp=
Jd.value,zy=void 0,n[(zy=Gp.videoItem)!=null?zy:""]=!0,Gp.videoItem&&(m=Ra=void 0,$B=(m=(Ra=g.il(Gp.videoItem))==null?void 0:Ra.entityId)!=null?m:"",R.push({externalVideoId:$B}));WZ=T.filter(function(E){if(!E||!E.key||!E.offlineVideoPolicy)return!1;E=g.il(E.key).entityId;E=g.oL(E,"downloadStatusEntity");var Xn;return!(E&&((Xn=S[E])==null?void 0:Xn.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
wR=WZ.map(function(E){var Xn=V[E.transfer],ci=[];if(Xn==null?0:Xn.offlineVideoStreams)for(var qu=g.e(Xn.offlineVideoStreams),Wi=qu.next();!Wi.done;Wi=qu.next())(Wi=b[Wi.value])&&ci.push(Wi);qu=c[E.offlineVideoPolicy];Wi=n;var wS=E==null?void 0:E.playerResponseTimestamp,zp=g.il(qu.key).entityId;E=g.oL(zp,"mainVideoEntity");if(qu.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Dt="OFFLINE_VIDEO_STATE_DISABLED";qu.expirationTimestamp&&Number(qu.expirationTimestamp)<Date.now()/1E3&&(Dt="OFFLINE_VIDEO_STATE_EXPIRED")}else if(qu.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Dt="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Xn==null?void 0:Xn.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Dt="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Dt="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Dt="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Dt="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Dt="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Dt="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Dt="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Dt==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Xn==null?void 0:Xn.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Dt="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Dt="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Dt=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}zp={id:zp,videoState:Dt};if(Xn==null?0:Xn.cotn)zp.cotn=Xn.cotn;if(Xn==null?0:Xn.maximumDownloadQuality)zp.selectedVideoQuality=Xn==null?void 0:Xn.maximumDownloadQuality;if(Xn==null?0:Xn.lastProgressTimeMs)zp.lastProgressTimeMs=Xn.lastProgressTimeMs;wS&&(zp.playerResponseSavedTimeMs=String(Number(wS)*1E3));Xn=String;wS=0;ci=g.e(ci);for(Dt=ci.next();!Dt.done;Dt=ci.next())if(Dt=Dt.value,Dt.streamsProgress){Dt=g.e(Dt.streamsProgress);for(var Pi=Dt.next();!Pi.done;Pi=
Dt.next()){var P=void 0;wS+=Number((P=Pi.value.numBytesDownloaded)!=null?P:0)}}zp.downloadedBytes=Xn(wS);zp.selectedOfflineMode=Wi[E]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";qu.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(zp.offlinePlaybackDisabledReason=qu.offlinePlaybackDisabledReason);return zp});
return eb.return({offlineVideos:wR,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:R}}})})},tnK=function(){this.locks=navigator.locks},Ng8=function(){try{var D=g.mn("ytglobal.locks_");
if(D)return D;var X;if(X=navigator){var M=navigator;X="locks"in M&&!!M.locks}if(X)return g.E8.localStorage&&g.E8.localStorage.getItem("noop"),D=new tnK,g.PZ("ytglobal.locks_",D),D}catch(Q){}},jG=function(){},q$B=function(){},wSb=function(D){if(D.includes(":"))throw Error("Invalid user cache name: "+D);
return D+":"+g.Jr("CacheStorage get")},Tgh=function(){return g.r(function(D){if(Dy!==void 0)return D.return(Dy);
Dy=new Promise(function(X){var M;return g.r(function(Q){switch(Q.S){case 1:return g.N_(Q,2),g.I(Q,XK.open("test-only"),4);case 4:return g.I(Q,XK.delete("test-only"),5);case 5:g.Ty(Q,3);break;case 2:if(M=g.LG(Q),M instanceof Error&&M.name==="SecurityError")return X(!1),Q.return();case 3:X("caches"in window),g.HZ(Q)}})});
return D.return(Dy)})},sch=function(){return g.r(function(D){if(D.S==1)return g.I(D,Tgh(),2);
if(!D.G)return D.return(void 0);LdW||(LdW=new q$B);return D.return(LdW)})},MA=function(D,X,M){g.P3(new g.ys("Woffle: "+D,M?{cotn:M}:""));
X instanceof Error&&g.P3(X)},KdB=function(D){var X;
return g.r(function(M){if(M.S==1)return g.I(M,HPy(D),2);X=M.G;g.Tm("offlineStateSnapshot",X);g.HZ(M)})},QT=function(D){g.O.call(this);
var X=this;this.api=D;this.py={ZQ$:function(){return X.S},
h1j:function(){return X.G}};
typeof g.E8.BroadcastChannel!=="undefined"&&(this.S=new g.E8.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Jr()),this.S.onmessage=this.Y.bind(this),this.G=new g.E8.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Jr()),this.G.onmessage=this.U.bind(this))},hZ=function(D,X){D.api.ER("onOfflineOperationFailure",X);
var M;(M=D.S)==null||M.postMessage(X)},aTB=function(D,X,M){var Q=this;
this.K=D;this.eH=X;this.visibility=M;this.D=this.J=this.X=this.Y=this.S=!1;this.U=new g.W5(function(){Q.We()});
this.py={fE:function(){return Q.G},
We:function(){Q.We()},
sA4:function(){return Q.U}};
this.visibility.subscribe("visibilitystatechange",function(){Q.a6()})},FdZ=function(D){if(!D.Y&&!D.S){var X=Ng8();
if(X){D.Y=!0;var M=g.Jr("OfflineLockManager");X.request("woffle_orchestration_leader:"+M,{},function(){var Q,h;return g.r(function(H){switch(H.S){case 1:return g.N_(H,2),D.G=new g.wh,D.S=!0,D.Y=!1,g.I(H,D.K(),4);case 4:return g.I(H,D.G.promise,5);case 5:g.Ty(H,0);break;case 2:Q=g.LG(H),D.We(),Q instanceof Error&&(h=Q,h.args=[{name:"WoLockManagerError",Uo:Q.name}],g.ET(h)),g.HZ(H)}})})}}},Vn_=function(D){D.S&&(D.D=!0,H6(D))},$bZ=function(D,X){D.S&&(D.X=X,H6(D))},BgK=function(D,X){D.S&&(D.J=X,H6(D))},
H6=function(D){D.J&&D.X&&D.D&&D.visibility.isBackground()?g.G1(D.U,6E4):D.U.stop()},tZ=function(D){var X;
D.offlineDeleteReason=(X=D.offlineDeleteReason)!=null?X:"OFFLINE_DELETE_REASON_UNKNOWN";var M;D.offlineModeType=(M=D.offlineModeType)!=null?M:"OFFLINE_NOW";g.Tm("offlineDeleteEvent",D)},NA=function(D,X){var M=X.videoId;
var Q=X.Qj;X=X.offlineModeType;D.encryptedVideoId=M;D.cotn=Q==null?void 0:Q.cotn;D.offlineabilityFormatType=Q==null?void 0:Q.maximumDownloadQuality;var h;D.isRefresh=(h=Q==null?void 0:Q.isRefresh)!=null?h:!1;var H;D.softErrorCount=(H=Q==null?void 0:Q.transferRetryCount)!=null?H:0;D.offlineModeType=X!=null?X:"OFFLINE_NOW";(D.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&D.statusType==="UNKNOWN_STATUS_TYPE"||!D.transferStatusType&&!D.statusType)&&g.P3(Error("Woffle unknown transfer status"));
g.Tm("offlineTransferStatusChanged",D)},ZPh=function(D){NA({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},D)},Ubn=function(D,X,M,Q){Q={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!Q};X&&M&&(X=Math.floor(X/1024).toFixed(),M=Math.floor(M/1024).toFixed(),Q.alreadyDownloadedKbytes=X,Q.totalFetchedKbytes=X,Q.totalContentKbytes=M);NA(Q,D)},c2b=function(D){NA({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},D)},fTG=function(D){NA({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},D)},S$C=function(D){switch(D){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
qA=function(D){var X,M,Q;
return((Q=(X=D.actionMetadata)==null?void 0:(M=X.retryScheduleIntervalsInSeconds)==null?void 0:M.length)!=null?Q:0)>0},wW=function(D){return D.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!D.entityKey},Tu=function(D){return D.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!D.entityKey},Lt=function(D){return D.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!D.entityKey},EqC=function(D){return D.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!D.entityKey},
sA=function(D,X,M,Q,h){h=h===void 0?!1:h;
var H,t,q,w,T,L;return g.r(function(K){if(K.S==1)return H=g.oL(D,X),t=g.oL(D,"downloadStatusEntity"),g.I(K,WV(M,{mode:"readonly",d3:!0},function(a){return g.Bc.all([OR(a,H,X),OR(a,t,"downloadStatusEntity")])}),2);
q=K.G;w=q.length?q[0]:void 0;if(!w)return K.D4(0);T=y2y;if(L=q.length>1?q[1]:void 0){if(L.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!h)return K.return();L.downloadState=Q}else L={key:t,downloadState:Q};g.RO(w,T,L);return g.I(K,WV(M,{mode:"readwrite",d3:!0},function(a){return g.Bc.all([Yh(a,w,X),Yh(a,L,"downloadStatusEntity")])}),0)})},Kt=function(D,X){return D.actionType===X.actionType&&D.entityKey===X.entityKey},aR=function(D,X){if(D&&D.transferState!=="TRANSFER_STATE_COMPLETE"&&D.transferState!==
"TRANSFER_STATE_FAILED"){var M=g.il(D.key).entityId;
NA({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:M,Qj:D,offlineModeType:X})}},FK=function(D){if(!D||!D.thumbnails)return[];
var X=[];D=g.e(D.thumbnails);for(var M=D.next();!M.done;M=D.next())M=M.value,M.url&&X.push(M.url);return X},P0G=function(D,X,M){M=M===void 0?[]:M;
var Q,h,H,t,q,w,T,L,K,a,F,V,c;return g.r(function(S){if(S.S==1)return M.length?g.I(S,kh(D,X),2):S.return([]);Q=S.G;h=new Set;H=g.e(Q);for(t=H.next();!t.done;t=H.next())if(q=t.value,w=q.id||q.key)T=g.il(w).entityId,h.add(T);L=[];K=g.e(M);for(a=K.next();!a.done;a=K.next())F=a.value,V=F.offlineVideoData,c=void 0,((c=V)==null?0:c.videoId)&&!h.has(V.videoId)&&L.push(F);return S.return(L)})},mbr=function(D,X,M){return new g.zL(D,{cotn:X,
raw_player_response:M,download_media:!0,start:Infinity,disable_watch_next:!0})},nqr=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},VT=function(D,X,M,Q,h,H,t,q,w,T,L){this.entityType=D;
this.actionId=X;this.action=M;this.parentActionId=Q;this.rootActionId=h===void 0?X:h;this.childActionIds=H;this.prereqActionId=t;this.postreqActionIds=q;this.hasChildActionFailed=T;this.retryScheduleIndex=0;this.S=L||Date.now();this.retryScheduleIndex=w||0},$b=function(D){if(!D.key)throw Error("Entity key is required.");
if(!D.actionProto)throw Error("OfflineOrchestrationAction is required.");var X=g.il(D.key),M=g.il(D.actionProto.entityKey);return new VT(M.entityType,X.entityId,D.actionProto,D.parentActionId,D.rootActionId,D.childActionIds,D.prereqActionId,D.postreqActionIds,D.retryScheduleIndex,D.hasChildActionFailed,Number(D.enqueueTimeSec)*1E3)},B6=function(D){return{key:g.oL(D.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:D.action,parentActionId:D.parentActionId,rootActionId:D.rootActionId,childActionIds:D.childActionIds,prereqActionId:D.prereqActionId,postreqActionIds:D.postreqActionIds,retryScheduleIndex:D.retryScheduleIndex,hasChildActionFailed:D.hasChildActionFailed,enqueueTimeSec:(D.S/1E3).toFixed()}},bPn=function(){var D;
return g.r(function(X){return X.S==1?g.I(X,sch(),2):(D=X.G)?X.return(D.delete("yt-player-local-img")):X.return(!0)})},Zy=function(D){var X,M;
return g.r(function(Q){if(Q.S==1)return g.I(Q,sch(),2);if(Q.S!=3){X=Q.G;if(!X)throw Error("Cache API not supported");return D.length?g.I(Q,X.open("yt-player-local-img"),3):Q.return()}M=Q.G;return g.I(Q,Promise.all(D.map(function(h){return M.delete(h)})),0)})},UA=function(D){var X,M;
return g.r(function(Q){if(Q.S==1)return g.I(Q,sch(),2);if(Q.S!=3){X=Q.G;if(!X)throw Error("Cache API not supported");return D.length?g.I(Q,X.open("yt-player-local-img"),3):Q.return()}M=Q.G;return g.I(Q,M.addAll(D),0)})},c6=function(D,X,M,Q,h){var H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs,S2,XC,q_,th,Jd,Gp,zy;
return g.r(function(Ra){switch(Ra.S){case 1:return H=g.oL(D,"mainVideoEntity"),t=g.oL(D,"ytMainChannelEntity"),q=g.oL(D,"transfer"),w=g.oL(D,"videoDownloadContextEntity"),g.I(Ra,WV(X,{mode:"readonly",d3:!0},function(m){return g.Bc.all([OR(m,H,"mainVideoEntity"),OR(m,t,"ytMainChannelEntity"),OR(m,q,"transfer"),OR(m,w,"videoDownloadContextEntity"),ph(m,"ytMainChannelEntity"),ph(m,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:T=Ra.G;L=g.e(T);K=L.next().value;a=L.next().value;F=L.next().value;V=L.next().value;c=L.next().value;S=L.next().value;b=K;n=a;R=F;v=V;l=c;A=S;if(!b&&!n){Ra.D4(3);break}Hs=b?FK(b.thumbnail):[];if(!n){u=[];Ra.D4(4);break}return g.I(Ra,eiG(n,l),5);case 5:u=Ra.G;case 4:return D_=u,g.I(Ra,Zy(Hs.concat(D_)),3);case 3:q5=[];Lo=g.oL(D,"downloadStatusEntity");Qs=g.e(A);for(S2=Qs.next();!S2.done;S2=Qs.next())XC=S2.value,q_=g.il(XC.key).entityId,th=$b(XC),Jd=g.il(th.action.entityKey).entityId,q_!==D&&
Jd!==D||Kt(M,XC.actionProto)||q5.push(XC.key);return g.I(Ra,WV(X,{mode:"readwrite",d3:!0},function(m){var $B=q5.map(function(WZ){return lV(m,WZ)});
$B.push(lV(m,H,{wX:!0}));$B.push(lV(m,Lo,{wX:!0}));return g.Bc.all($B)}),7);
case 7:zy=(Gp=v)==null?void 0:Gp.offlineModeType,h&&(tZ(h),h.offlineModeType&&(zy=h.offlineModeType)),aR(R,zy),hZ(Q,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.HZ(Ra)}})},gqZ=function(D,X,M,Q){var h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs,S2,XC,q_,th,Jd,Gp,zy,Ra,m,$B,WZ,wR,eb,E,Xn,ci,qu,Wi,wS,zp,Dt,Pi,P,f,y;
return g.r(function(d){switch(d.S){case 1:return h=g.oL(D,"mainPlaylistEntity"),H=g.oL(D,"ytMainChannelEntity"),g.I(d,WV(X,{mode:"readonly",d3:!0},function(W){return g.Bc.all([OR(W,h,"mainPlaylistEntity"),OR(W,H,"ytMainChannelEntity"),ph(W,"mainPlaylistEntity"),ph(W,"mainDownloadsListEntity"),ph(W,"ytMainChannelEntity"),ph(W,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:t=d.G;q=g.e(t);w=q.next().value;T=q.next().value;L=q.next().value;K=q.next().value;a=q.next().value;F=q.next().value;V=w;c=T;S=L;b=K;n=a;R=F;if(!V&&!c){d.D4(3);break}v=V?Rib(V):[];if(!c){l=[];d.D4(4);break}return g.I(d,eiG(c,n),5);case 5:l=d.G;case 4:return A=l,g.I(d,Zy(v.concat(A)),3);case 3:Hs=[];u=new Map;if(!V){d.D4(7);break}return g.I(d,ITG(V,S,b),8);case 8:Hs=d.G;D_=g.e(Hs);for(q5=D_.next();!q5.done;q5=D_.next())Lo=q5.value,u.set(Lo,{videoId:Lo,playlistId:D,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.I(d,WV(X,{mode:"readonly",d3:!0},function(W){return g.Bc.all([ph(W,"transfer"),ph(W,"videoDownloadContextEntity")])}),9);
case 9:Qs=d.G;S2=g.e(Qs);XC=S2.next().value;q_=S2.next().value;th=XC;Jd=q_;Gp=g.e(th);for(zy=Gp.next();!zy.done;zy=Gp.next())Ra=zy.value,m=g.il(Ra.key).entityId,($B=u.get(m))&&Ra&&($B.cotn=Ra.cotn);WZ=g.e(Jd);for(wR=WZ.next();!wR.done;wR=WZ.next())eb=wR.value,E=g.il(eb.key).entityId,(Xn=u.get(E))&&eb&&(Xn.offlineModeType=eb.offlineModeType);case 7:ci=[];qu=g.e(R);for(Wi=qu.next();!Wi.done;Wi=qu.next())wS=Wi.value,zp=g.il(wS.key).entityId,Dt=$b(wS),zp!==D&&Dt.rootActionId!==D||Kt(M,wS.actionProto)||
ci.push(wS.key);Pi=g.oL(D,"mainPlaylistEntity");return g.I(d,WV(X,{mode:"readwrite",d3:!0},function(W){var N5=ci.map(function(z){return lV(W,z)});
N5.push(lV(W,Pi,{wX:!0}));return g.Bc.all(N5)}),10);
case 10:if(!V){d.D4(0);break}Hs.reverse();if(!Hs){d.D4(0);break}P=g.e(Hs);f=P.next();case 13:if(f.done){d.D4(0);break}y=f.value;return g.I(d,c6(y,X,M,Q,u.get(y)),14);case 14:f=P.next(),d.D4(13)}})},dbn=function(D,X,M,Q){var h,H,t,q,w,T,L,K,a;
return g.r(function(F){if(F.S==1)return h=g.oL("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),H=new Map,g.I(F,WV(D,{mode:"readwrite",d3:!0},function(V){var c=ph(V,"transfer"),S=ph(V,"offlineOrchestrationActionWrapperEntity"),b=ph(V,"videoDownloadContextEntity"),n=OR(V,h,"mainDownloadsListEntity");return g.Bc.all([c,S,b,n]).then(function(R){R=g.e(R);var v=R.next().value;var l=R.next().value;var A=R.next().value;var Hs=R.next().value;R=vqG.map(function(D_){return bpr(V,D_)});
l=g.e(l);for(var u=l.next();!u.done;u=l.next())u=u.value,Kt(X,u.actionProto)||R.push(lV(V,u.key,{wX:!0}));Hs&&(Hs.downloads=[],R.push(Yh(V,Hs,"mainDownloadsListEntity")));if(A)for(A=g.e(A),Hs=A.next();!Hs.done;Hs=A.next())Hs=Hs.value,l=g.il(Hs.key).entityId,l=g.oL(l,"transfer"),H.set(l,Hs.offlineModeType);return g.Bc.all(R).then(function(){return v})})}),2);
t=F.G;q=g.e(t);for(w=q.next();!w.done;w=q.next())T=w.value,aR(T,H.get(T.key)),L=g.il(T.key).entityId,K={videoId:L,offlineDeleteReason:Q,cotn:T.cotn,offlineModeType:H.get(T.key)},tZ(K),a=g.oL(L,"mainVideoEntity"),hZ(M,{entityKey:a,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.I(F,bPn(),0)})},Rib=function(D,X){var M=[];
if(D.thumbnailStyleData){D=g.e(D.thumbnailStyleData);for(var Q=D.next();!Q.done;Q=D.next()){var h=void 0,H=void 0,t=void 0;M=M.concat(FK((h=Q.value)==null?void 0:(H=h.value)==null?void 0:(t=H.collageThumbnail)==null?void 0:t.coverThumbnail))}}X=FK(X);return M.concat(X)},ITG=function(D,X,M){var Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_;
return g.r(function(q5){Q=[];h=new Set;if(M.length)for(H=g.e(M),t=H.next();!t.done;t=H.next())if(q=t.value,w=void 0,(w=q.downloads)==null?0:w.length)for(T=g.e(q.downloads),L=T.next();!L.done;L=T.next())K=L.value,K.videoItem&&(a=g.il(K.videoItem).entityId,h.add(a));if(D.videos){F=g.e(D.videos);for(V=F.next();!V.done;V=F.next())c=V.value,S=JSON.parse(g.il(c).entityId),S.videoId&&!h.has(S.videoId)&&Q.push(S.videoId);b=g.e(X);for(n=b.next();!n.done;n=b.next())if(R=n.value,R.key!==D.key&&(v=R.videos))for(l=
g.e(v),A=l.next();!A.done;A=l.next())Hs=A.value,u=JSON.parse(g.il(Hs).entityId),u.videoId&&(D_=Q.indexOf(u.videoId),D_!==-1&&Q.splice(D_,1))}return q5.return(Q)})},eiG=function(D,X){var M,Q,h,H,t,q,w,T;
return g.r(function(L){M=FK(D.avatar);Q=g.e(X);for(h=Q.next();!h.done;h=Q.next())if(H=h.value,H.id!==D.id)for(t=g.e(FK(H.avatar)),q=t.next();!q.done;q=t.next())w=q.value,T=M.indexOf(w),T!==-1&&M.splice(T,1);return L.return(M)})},r2W=function(D){var X;
return g.r(function(M){X=g.Z(D.frameworkUpdates,ft);return D.frameworkUpdates&&X?g.I(M,ALa(X),0):M.return()})},oqt=function(D){var X;
if((X=D.onResponseReceivedActions)!=null&&X.length){var M;D=(M=g.Z(g.Z(D.onResponseReceivedActions[0],iPn),g.oWB))==null?void 0:M.actions;if(D!=null&&D.length)return D}},C0W=function(D){var X,M,Q;
return g.r(function(h){if(h.S==1)return D?g.I(h,zs(D,g.Ir,"mainDownloadsListEntity"),2):h.return([]);X=h.G;return((M=X)==null?0:(Q=M.downloads)==null?0:Q.length)?h.return(X.downloads.map(function(H){var t;return(t=H.videoItem)!=null?t:""})):h.return([])})},pSn=function(D,X){var M;
return g.r(function(Q){return Q.S==1?g.I(Q,OPB(D,X),2):(M=Q.G)?g.I(Q,WV(D,{mode:"readwrite",d3:!0},function(h){var H=[Yh(h,M.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];M.mainDownloadsListEntity&&H.push(Yh(h,M.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Bc.all(H)}),0):Q.D4(0)})},OPB=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R;
return g.r(function(v){if(v.S==1)return M=g.oL("main_downloads_library_id","mainDownloadsLibraryEntity"),Q=g.oL("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.I(v,WV(D,{mode:"readonly",d3:!0},function(l){return g.Bc.all([OR(l,M,"mainDownloadsLibraryEntity"),OR(l,Q,"mainDownloadsListEntity")])}),2);
h=v.G;H=g.e(h);t=H.next().value;q=H.next().value;w=t;T=q;w||(w={id:M});L=g.e(X);for(K=L.next();!K.done;K=L.next())if(a=K.value,a===g.Ir){if(w.smartDownloadsList)return v.return();w.smartDownloadsList=a}else if(F=g.il(a).entityType,V={},F==="mainPlaylistEntity"?V.playlistItem=a:F==="mainVideoEntity"&&(V.videoItem=a),!g.ef(V)){c=void 0;if((c=T)==null?0:c.downloads){S=!1;b=g.e(T.downloads);for(n=b.next();!n.done;n=b.next())if(R=n.value,R.playlistItem===a||R.videoItem===a){S=!0;break}S||T.downloads.push(V)}else T=
{id:Q,downloads:[V]};w.downloadsList=Q}return v.return({mainDownloadsLibraryEntity:w,mainDownloadsListEntity:T})})},A2K=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S;
return g.r(function(b){if(b.S==1)return M=g.oL("main_downloads_library_id","mainDownloadsLibraryEntity"),Q=g.oL("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.I(b,WV(D,{mode:"readonly",d3:!0},function(n){return g.Bc.all([OR(n,M,"mainDownloadsLibraryEntity"),OR(n,Q,"mainDownloadsListEntity"),OR(n,g.Ir,"mainDownloadsListEntity")])}),2);
h=b.G;H=g.e(h);t=H.next().value;q=H.next().value;w=H.next().value;T=t;L=q;K=w;if(!T)return b.D4(0);if(X===g.Ir&&((a=K)==null?0:a.downloads))K.downloads=[];else if((F=L)==null?0:F.downloads)for(V=g.il(X).entityType,c=0;c<L.downloads.length;c++)if(S=L.downloads[c],V==="mainVideoEntity"&&S.videoItem===X){L.downloads.splice(c,1);break}else if(V==="mainPlaylistEntity"&&S.playlistItem===X){L.downloads.splice(c,1);break}return g.I(b,WV(D,{mode:"readwrite",d3:!0},function(n){var R=[Yh(n,T,"mainDownloadsLibraryEntity")];
L&&R.push(Yh(n,L,"mainDownloadsListEntity"));K&&R.push(Yh(n,K,"mainDownloadsListEntity"));return g.Bc.all(R)}),0)})},Sc=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a;
return g.r(function(F){if(F.S==1)return M=g.oL(X,"transfer"),Q=g.oL(X,"videoDownloadContextEntity"),g.I(F,WV(D,{mode:"readonly",d3:!0},function(V){return g.Bc.all([OR(V,M,"transfer"),OR(V,Q,"videoDownloadContextEntity")])}),2);
h=F.G;H=g.e(h);t=H.next().value;q=H.next().value;w=t;T=q;a={videoId:X,cotn:(L=w)==null?void 0:L.cotn,offlineModeType:(K=T)==null?void 0:K.offlineModeType};return F.return(a)})},EA=function(D,X,M,Q,h){var H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u;
return g.r(function(D_){switch(D_.S){case 1:return H=g.oL(D,"musicTrack"),t=g.oL(D,"transfer"),g.I(D_,WV(X,{mode:"readonly",d3:!0},function(q5){return g.Bc.all([OR(q5,H,"musicTrack"),OR(q5,t,"transfer"),ph(q5,"musicTrack"),ph(q5,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:q=D_.G;w=g.e(q);T=w.next().value;L=w.next().value;K=w.next().value;a=w.next().value;F=T;V=L;c=K;S=a;if(!F){D_.D4(3);break}return g.I(D_,Y$a(F,c),4);case 4:return b=D_.G,g.I(D_,Zy(b),3);case 3:n=[];R=g.e(S);for(v=R.next();!v.done;v=R.next())l=v.value,A=g.il(l.key).entityId,Hs=$b(l),u=g.il(Hs.action.entityKey).entityId,A!==D&&u!==D||Kt(M,l.actionProto)||n.push(l.key);return g.I(D_,WV(X,{mode:"readwrite",d3:!0},function(q5){var Lo=n.map(function(Qs){return lV(q5,Qs)});
Lo.push(lV(q5,H,{wX:!0}));return g.Bc.all(Lo)}),6);
case 6:aR(V),h&&tZ(h),hZ(Q,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.HZ(D_)}})},yT=function(D,X,M,Q,h){var H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs,S2,XC,q_,th,Jd,Gp,zy,Ra,m,$B,WZ,wR;
return g.r(function(eb){switch(eb.S){case 1:return H=g.oL(D,X),t=g.oL("music_downloads_library_id","musicDownloadsLibraryEntity"),g.I(eb,WV(M,{mode:"readonly",d3:!0},function(E){return g.Bc.all([OR(E,H,X),OR(E,t,"musicDownloadsLibraryEntity"),ph(E,X),ph(E,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:q=eb.G;w=g.e(q);T=w.next().value;L=w.next().value;K=w.next().value;a=w.next().value;F=T;V=L;c=K;S=a;if(!F){eb.D4(3);break}return g.I(eb,Y$a(F,c),4);case 4:return b=eb.G,g.I(eb,Zy(b),3);case 3:n=[];R=new Map;if(!F){eb.D4(6);break}return g.I(eb,lTh(F,c,V),7);case 7:n=eb.G;v=g.e(n);for(l=v.next();!l.done;l=v.next())A=l.value,Hs=g.il(A).entityId,R.set(Hs,{videoId:Hs,playlistId:D,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.I(eb,kh(M,"transfer"),8);case 8:for(u=eb.G,
D_=g.e(u),q5=D_.next();!q5.done;q5=D_.next())Lo=q5.value,Qs=g.il(Lo.key).entityId,(S2=R.get(Qs))&&Lo&&(S2.cotn=Lo.cotn);case 6:XC=[];q_=g.e(S);for(th=q_.next();!th.done;th=q_.next())Jd=th.value,Gp=g.il(Jd.key).entityId,zy=$b(Jd),Gp!==D&&zy.rootActionId!==D||Kt(Q,Jd.actionProto)||XC.push(Jd.key);Ra=g.oL(D,X);return g.I(eb,WV(M,{mode:"readwrite",d3:!0},function(E){var Xn=XC.map(function(ci){return lV(E,ci)});
Xn.push(lV(E,Ra,{wX:!0}));return g.Bc.all(Xn)}),9);
case 9:if(!F){eb.D4(0);break}n.reverse();if(!n.length){eb.D4(0);break}m=g.e(n);$B=m.next();case 12:if($B.done){eb.D4(0);break}WZ=$B.value;wR=g.il(WZ).entityId;if(!wR){eb.D4(13);break}return g.I(eb,EA(wR,M,Q,h,R.get(wR)),13);case 13:$B=m.next(),eb.D4(12)}})},P6=function(D,X,M){var Q,h,H,t,q,w,T;
return g.r(function(L){if(L.S==1)return g.I(L,WV(D,{mode:"readwrite",d3:!0},function(K){var a=ph(K,"transfer"),F=ph(K,"offlineOrchestrationActionWrapperEntity");return g.Bc.all([a,F]).then(function(V){V=g.e(V);var c=V.next().value;var S=V.next().value;V=J28.map(function(v){return bpr(K,v)});
S=g.e(S);for(var b=S.next();!b.done;b=S.next()){b=b.value;var n=g.il(b.actionProto.entityKey).entityType==="musicTrack",R=b.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Kt(X,b.actionProto)||n&&(!n||R)||V.push(lV(K,b.key,{wX:!0}))}return g.Bc.all(V).then(function(){return c})})}),2);
Q=L.G;h=g.e(Q);for(H=h.next();!H.done;H=h.next())t=H.value,aR(t),q=g.il(t.key).entityId,w={videoId:q,offlineDeleteReason:void 0,cotn:t.cotn},tZ(w),T=g.oL(q,"musicTrack"),hZ(M,{entityKey:T,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.I(L,bPn(),0)})},xbh=function(D){for(var X,M=g.e(D.additionalMetadatas),Q=M.next();!Q.done;Q=M.next())Q=Q.value,Q.offlineMusicVideoData&&(X=Q.offlineMusicVideoData);
var h,H,t,q,w;return{id:g.oL(D.videoId,"musicTrack"),videoId:D.videoId,title:D.title,thumbnailDetails:D.thumbnail,lengthMs:String(Number(D.lengthSeconds)*1E3),albumTitle:(h=X)==null?void 0:h.releaseTitle,musicVideoType:(H=X)==null?void 0:H.musicVideoType,contentRating:{explicitType:(t=X)==null?void 0:t.explicitType},artistNames:((q=X)==null?void 0:q.byline)||((w=X)==null?void 0:w.channelName),downloadMetadata:g.oL(D.videoId,"musicTrackDownloadMetadataEntity")}},lTh=function(D,X,M){var Q,h,H,t,q,w,
T,L,K,a,F,V,c,S,b,n,R,v;
return g.r(function(l){Q=[];h=new Set;if((H=M)==null?0:(t=H.downloadedTracks)==null?0:t.length)for(q=g.e(M.downloadedTracks),w=q.next();!w.done;w=q.next())T=w.value,h.add(T);if(D.tracks){L=g.e(D.tracks);for(K=L.next();!K.done;K=L.next())a=K.value,h.has(a)||Q.push(a);F=g.e(X);for(V=F.next();!V.done;V=F.next())if(c=V.value,c.id!==D.id&&(S=c.tracks))for(b=g.e(S),n=b.next();!n.done;n=b.next())R=n.value,v=Q.indexOf(R),v!==-1&&Q.splice(v,1)}return l.return(Q)})},Y$a=function(D,X){var M,Q,h,H,t,q,w,T;
return g.r(function(L){M=FK(D.thumbnailDetails);Q=g.e(X);for(h=Q.next();!h.done;h=Q.next())if(H=h.value,H.id!==D.id)for(t=g.e(FK(H.thumbnailDetails)),q=t.next();!q.done;q=t.next())w=q.value,T=M.indexOf(w),T!==-1&&M.splice(T,1);return L.return(M)})},Wdh=function(D,X){var M,Q,h,H,t,q,w,T,L;
return g.r(function(K){if(K.S==1)return M=g.oL("music_downloads_library_id","musicDownloadsLibraryEntity"),g.I(K,zs(D,M,"musicDownloadsLibraryEntity"),2);(Q=K.G)||(Q={id:M});h=g.il(X).entityType;h==="musicTrack"?(H=Q.downloadedTracks)!=null&&H.includes(X)||(Q.downloadedTracks=((t=Q.downloadedTracks)!=null?t:[]).concat(X)):h==="musicPlaylist"?(q=Q.downloadedPlaylists)!=null&&q.includes(X)||(Q.downloadedPlaylists=((w=Q.downloadedPlaylists)!=null?w:[]).concat(X)):h!=="musicAlbumRelease"||(T=Q.downloadedAlbumReleases)!=
null&&T.includes(X)||(Q.downloadedAlbumReleases=((L=Q.downloadedAlbumReleases)!=null?L:[]).concat(X));return g.I(K,Gs(D,Q,"musicDownloadsLibraryEntity"),0)})},GeB=function(D,X){var M,Q,h,H,t,q,w;
return g.r(function(T){if(T.S==1)return M=g.oL("music_downloads_library_id","musicDownloadsLibraryEntity"),g.I(T,zs(D,M,"musicDownloadsLibraryEntity"),2);Q=T.G;if(!Q)return T.D4(0);h=g.il(X).entityType;h==="musicTrack"?H=Q.downloadedTracks:h==="musicPlaylist"&&(H=Q.downloadedPlaylists);if((t=H)==null?0:t.length)for(q=0;q<H.length;q++)if(w=H[q],w===X){H.splice(q,1);break}return g.I(T,Gs(D,Q,"musicDownloadsLibraryEntity"),0)})},zia=function(D){var X=D.videos;
D=[];var M=[];if(X){X=g.e(X);for(var Q=X.next();!Q.done;Q=X.next()){var h=Q.value.offlineVideoData.videoId;Q=g.oL(h,"musicTrack");h=g.oL(h,"musicTrackDownloadMetadataEntity");D.push(Q);M.push(h)}}return{TG:D,M0:M}},mP=function(D,X,M){X={track:xbh(X)};
M&&(X.playlistId=M);if(D=g.Z(D.actionMetadata,keW))X.maximumDownloadQuality=D.maximumDownloadQuality;return{musicTrackEntityActionMetadata:X}},jch=function(D){var X,M,Q,h,H,t,q,w;
return g.r(function(T){switch(T.S){case 1:return X=g.YU(),M=kk8(D),Q=g.Gq(u8y),g.N_(T,2),H={j3:!0},g.I(T,g.RQ(X,M,Q,void 0,H),4);case 4:h=T.G;g.Ty(T,3);break;case 2:t=g.LG(T);if(t instanceof g.Og)throw q="GetOffline network manager error: "+t.message,MA(q,t),Error(q);MA("GetOffline fetch request error",t);throw Error("GetOffline fetch request error");case 3:w=nt(h);if(!h)throw MA("Network request failed"),Error("Network request failed");if(w!==void 0)bo(w);else if(!h.videos||!h.videos.length)throw MA("No data"),
Error("No data");return T.return(h.videos.map(function(L){return L.offlineVideoData}))}})},DNt=function(D){var X,M,Q,h,H,t,q,w;
return g.r(function(T){switch(T.S){case 1:return X=g.YU(),M=u0G(D),Q=g.Gq(u8y),g.N_(T,2),H={j3:!0},g.I(T,g.RQ(X,M,Q,void 0,H),4);case 4:h=T.G;g.Ty(T,3);break;case 2:t=g.LG(T);if(t instanceof g.Og)throw q="GetOffline network manager error for playlist: "+t.message,MA(q,t),Error(q);MA("GetOffline fetch request error for playlist",t);throw Error("GetOffline fetch request error for playlist");case 3:w=nt(h);if(!h)throw MA("Network request failed for playlist"),Error("Network request failed for playlist");
if(w!==void 0)bo(w,"playlist");else if(!h.playlists||!h.playlists.length)throw MA("No data for playlist"),Error("No data for playlist");return T.return(h.playlists.map(function(L){return L.offlinePlaylistData}))}})},MwC=function(D,X,M,Q){var h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs,S2,XC,q_,th,Jd;
return g.r(function(Gp){switch(Gp.S){case 1:return g.I(Gp,uV(),2);case 2:h=Gp.G;if(!h)return Gp.return([]);H=[];if((t=Q)==null?0:t.length){H=Q;Gp.D4(3);break}return g.I(Gp,kh(h,"mainPlaylistEntity"),4);case 4:H=Gp.G;case 3:if(!H.length)return Gp.return([]);q=[];w=Date.now()/1E3;T=g.e(H);L=T.next();case 5:if(L.done)return q.length?g.I(Gp,XLn(q),10):Gp.return([]);K=L.value;if(!K.downloadState){a=void 0;Gp.D4(8);break}return g.I(Gp,zs(h,K.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:a=
Gp.G;case 8:F=a;V=void 0;S=(c=(V=K)==null?void 0:V.entityMetadata)&&c.nextAutoRefreshIntervalSeconds?Number(c.nextAutoRefreshIntervalSeconds):NaN;b=Number.isNaN(S)?D:S;R=n=void 0;v=((n=F)==null?0:n.lastSyncedTimestampMillis)?Number((R=F)==null?void 0:R.lastSyncedTimestampMillis)/1E3:0;A=l=void 0;Hs=((l=F)==null?0:l.addedTimestampMillis)?Number((A=F)==null?void 0:A.addedTimestampMillis)/1E3:0;if(M||!c||v+b<=w){u=[];D_=void 0;if((D_=K.videos)==null?0:D_.length)for(q5=g.e(K.videos),Lo=q5.next();!Lo.done;Lo=
q5.next())Qs=Lo.value,S2=JSON.parse(g.il(Qs).entityId),S2.videoId&&u.push(S2.videoId);XC="0";c&&(q_=void 0,XC=String(Number((q_=c.offlineLastModifiedTimestampSeconds)!=null?q_:0).toFixed()));th={playlistId:K.playlistId,videoIds:u,offlineLastModifiedTimestamp:XC,autoSync:X,offlineDateAddedTimestamp:String(Hs.toFixed())};q.push(th)}L=T.next();Gp.D4(5);break;case 10:return Jd=Gp.G,Gp.return(Jd)}})},Q3t=function(){var D,X,M,Q,h;
return g.r(function(H){if(H.S==1)return g.I(H,uV(),2);if(H.S!=3)return(D=H.G)?g.I(H,kh(D,"refresh"),3):H.return(!1);X=H.G;if((M=X[0])==null||!M.refreshTime)return H.return(!1);Q=Number(X[0].refreshTime);h=Date.now()/1E3;return H.return(isFinite(Q)&&h>=Q)})},Hmn=function(D,X){var M,Q,h;
return g.r(function(H){switch(H.S){case 1:return g.N_(H,2),g.I(H,h2n(D,X),4);case 4:return Q=H.G,g.I(H,r2W(Q),5);case 5:M=oqt(Q);g.Ty(H,3);break;case 2:h=g.LG(H),MA("getAndProcessSmartDownloadsResponse request or processing error",h);case 3:return H.return(M)}})},twr=function(D,X,M,Q){var h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs,S2,XC,q_,th,Jd;
return g.r(function(Gp){switch(Gp.S){case 1:return g.I(Gp,uV(),2);case 2:h=Gp.G;if(!h)return Gp.return([]);H=[];if((t=Q)==null?0:t.length){H=Q;Gp.D4(3);break}return g.I(Gp,kh(h,"musicPlaylist"),4);case 4:H=Gp.G;case 3:if(!H.length)return Gp.return([]);q=[];w=Date.now()/1E3;T=g.e(H);L=T.next();case 5:if(L.done)return q.length?g.I(Gp,XLn(q),10):Gp.return([]);K=L.value;a=void 0;V=(F=(a=K)==null?void 0:a.entityMetadata)&&F.nextAutoRefreshIntervalSeconds?Number(F.nextAutoRefreshIntervalSeconds):NaN;c=
Number.isNaN(V)?D:V;b=S=0;n="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!K.downloadMetadata){Gp.D4(8);break}return g.I(Gp,zs(h,K.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:R=Gp.G,l=v=void 0,S=Number((l=(v=R)==null?void 0:v.addedTimestampMillis)!=null?l:"0")/1E3,Hs=A=void 0,b=Number((Hs=(A=R)==null?void 0:A.lastModifiedTimestampMillis)!=null?Hs:"0")/1E3,D_=u=void 0,n=(D_=(u=R)==null?void 0:u.syncState)!=null?D_:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:q5=void 0;if(M||n!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!F||Number((q5=F.lastSyncedTimestampSeconds)!=null?q5:0)+c<=w){Lo=[];Qs=void 0;if((Qs=K.tracks)==null?0:Qs.length)for(S2=g.e(K.tracks),XC=S2.next();!XC.done;XC=S2.next())q_=XC.value,Lo.push(g.il(q_).entityId);th={playlistId:K.playlistId,videoIds:Lo,offlineLastModifiedTimestamp:String(b.toFixed()),autoSync:X,offlineDateAddedTimestamp:String(S.toFixed())};q.push(th)}L=T.next();Gp.D4(5);break;case 10:return Jd=Gp.G,Gp.return(Jd)}})},h2n=function(D,X){var M,Q,h,H,t,q,w,T,L,K;
return g.r(function(a){switch(a.S){case 1:return M=g.YU(),g.I(a,uV(),2);case 2:Q=a.G;if(!Q){a.D4(3);break}return g.I(a,HPy(Q),4);case 4:h=a.G;case 3:var F=h;H={context:g.Jq(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:D},offlineClientState:F,clientStateRequestData:{preferredFormatType:X}}}};t=g.Gq(N4C);g.N_(a,5);w={j3:!0};return g.I(a,g.RQ(M,H,t,void 0,w),7);case 7:q=a.G;g.Ty(a,6);break;case 5:T=g.LG(a);if(T instanceof g.Og)throw L=
"DPS network manager error for smart downloads: "+T.message,MA(L,T),Error(L);MA("DPS fetch request error for smart downloads",T);throw Error("DPS fetch request error for smart downloads");case 6:K=nt(q);if(q)K!==void 0&&bo(K,"smart downloads");else throw MA("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return a.return(q)}})},wLb=function(D,X){var M,Q,h,H,t,q,w,T;
return g.r(function(L){switch(L.S){case 1:return M=g.YU(),Q={context:g.Jq(),videoPlaybackPositionEntities:D,lastSyncTimestampUsec:X},h=g.Gq(qsb),g.N_(L,2),t={j3:!0},g.I(L,g.RQ(M,Q,h,void 0,t),4);case 4:H=L.G;g.Ty(L,3);break;case 2:q=g.LG(L);if(q instanceof g.Og)throw w="VPPS network manager error: "+q.message,MA(w,q),Error(w);MA("VPPS fetch request error",q);throw Error("VPPS fetch request error");case 3:T=nt(H);if(H)T!==void 0&&bo(T,"position sync");else throw MA("Network request failed for position sync"),
Error("Network request failed for position sync");return L.return(H)}})},Lph=function(D,X,M){var Q,h,H,t,q,w,T,L;
return g.r(function(K){switch(K.S){case 1:Q=g.YU();var a=M.refreshData,F=M.isEnqueuedForExpiredStreamUrlRefetch,V=M.hJ,c=M.offlineSourceData,S=M.mediaCapabilities,b={entityKey:D};a&&(b.refreshData=a);F&&(b.isExpiredStreamUrlRefetch=F);V&&(b.downloadParameters=V);c&&(b.offlineSourceData=c);a={context:g.HB(X),signatureTimestamp:20401,videos:[b]};S&&(a.mediaCapabilities=S);h=a;H=g.Gq(T4B);g.N_(K,2);q={j3:!0};return g.I(K,g.RQ(Q,h,H,void 0,q),4);case 4:t=K.G;g.Ty(K,3);break;case 2:w=g.LG(K);if(w instanceof
g.Og)throw T="GetPDE network manager error: "+w.message,MA(T,w),Error(T);MA("GetPDE fetch request error",w);throw Error("GetPDE fetch request error");case 3:L=nt(t);if(t)L!==void 0&&bo(L,"PDE");else throw MA("Network request failed for PDE"),Error("Network request failed for PDE");return K.return(t)}})},nt=function(D){var X;
return(X=D.errorMetadata)==null?void 0:X.status},bo=function(D,X){X=X?" for "+X:"";
if(D===0)throw D="Empty response body"+X,MA(D),Error(D);D="Response with error"+X;MA(D);throw Error(D);},XLn=function(D){var X,M,Q,h,H,t,q,w;
return g.r(function(T){switch(T.S){case 1:return X=g.YU(),M=jmC(D),Q=g.Gq(s3G),g.N_(T,2),H={j3:!0},g.I(T,g.RQ(X,M,Q,void 0,H),4);case 4:h=T.G;g.Ty(T,3);break;case 2:t=g.LG(T);if(t instanceof g.Og)throw q="offlinePlaylistSyncCheck network manager error: "+t.message,MA(q,t),Error(q);MA("offlinePlaylistSyncCheck fetch request error",t);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:w=nt(h);if(!h)throw MA("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(w!==void 0)bo(w,"playlist sync");else if(!h.offlinePlaylistSyncCheckDatas||!h.offlinePlaylistSyncCheckDatas.length)throw MA("No data for playlist sync"),Error("No data for playlist sync");return T.return(h.offlinePlaylistSyncCheckDatas.map(function(L){return L.offlinePlaylistSyncCheckData}))}})},ec=function(D){this.S=D},Kph=function(D,X){var M,Q,h,H,t,q;
return g.r(function(w){switch(w.S){case 1:M=new Map,Q=g.e(X),h=Q.next();case 2:if(h.done){w.D4(4);break}H=h.value;t=M;q=t.set;return g.I(w,D.G(H),5);case 5:q.call(t,H,w.G);h=Q.next();w.D4(2);break;case 4:return w.return(M)}})},RR=function(D,X,M,Q,h,H){X=g.oL(X,M);
Q=Object.assign({},H,{priority:Q,retryScheduleIntervalsInSeconds:h});return{actionType:D,entityKey:X,actionMetadata:Q}},IR=function(D,X,M,Q,h,H){this.status=D;
this.S=X;this.U=M;this.G=Q;this.Y=h;this.downloadState=H},air=function(D,X,M){this.S=D;
this.j=X;this.Y=M},$Nh=function(D,X){var M,Q,h,H,t,q,w,T,L;
return g.r(function(K){switch(K.S){case 1:return M=X.entityKey,h=(Q=g.Z(X.actionMetadata,gW))==null?void 0:Q.isEnqueuedForExpiredStreamUrlRefetch,g.N_(K,2),H=void 0,g.I(K,FpC(D,X),4);case 4:H=K.G;g.N_(K,5);var a=(a=g.Z(X.actionMetadata,gW))?{maximumDownloadQuality:a.maximumDownloadQuality}:void 0;return g.I(K,Lph(M,D.j,{isEnqueuedForExpiredStreamUrlRefetch:h,hJ:a,offlineSourceData:H}),7);case 7:t=K.G;g.Ty(K,6,2);break;case 5:return g.LG(K,2),q=qA(X)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",MA("PDE handleAdd error"),K.return(v6(X,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",q,"DOWNLOAD_STATE_FAILED"));case 6:return g.I(K,Vwr(D,t,X),8);case 8:return K.return(v6(X,!0,t.orchestrationActions));case 2:return w=g.LG(K),T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.Li&&w.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),MA("PDE handleAdd error"),K.return(v6(X,!1,void 0,T,L,"DOWNLOAD_STATE_FAILED"))}})},UNC=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_;
return g.r(function(q5){switch(q5.S){case 1:return M=X.entityKey,Q=g.il(M).entityId,g.I(q5,WV(D.S,{mode:"readonly",d3:!0},function(Lo){var Qs=OR(Lo,M,"playbackData"),S2=OR(Lo,g.oL(Q,"offlineVideoPolicy"),"offlineVideoPolicy");Lo=OR(Lo,g.oL(Q,"transfer"),"transfer");return g.Bc.all([Qs,S2,Lo])}),2);
case 2:h=q5.G;H=g.e(h);t=H.next().value;q=H.next().value;w=H.next().value;T=t;L=q;K=w;if(!T||!L)return q5.return(v6(X,!0));a=[];c=((V=T)==null?0:V.playerResponseJson)?JSON.parse(T.playerResponseJson):null;if(!(K&&c&&D.j.T("html5_refresh_deprecated_downloads"))){q5.D4(3);break}F=B4b(D,c,K);return g.I(q5,ZmC(D,K),4);case 4:a=q5.G;case 3:S={lastPlayerResponseTimestampSeconds:T.playerResponseTimestamp,offlineToken:L.offlineToken,formatIds:a};b={};if((n=K)==null?0:n.maximumDownloadQuality)b.maximumDownloadQuality=
K.maximumDownloadQuality;g.N_(q5,5);R=void 0;return g.I(q5,FpC(D,X),7);case 7:return R=q5.G,g.N_(q5,8),g.I(q5,Lph(M,D.j,{refreshData:S,hJ:b,offlineSourceData:R,mediaCapabilities:F}),10);case 10:v=q5.G;g.Ty(q5,9,5);break;case 8:return g.LG(q5,5),l=qA(X)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",MA("PDE handleRefresh error"),q5.return(v6(X,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",l,"DOWNLOAD_STATE_FAILED"));
case 9:return g.I(q5,Vwr(D,v,X),11);case 11:return q5.return(v6(X,!0,v.orchestrationActions));case 5:return A=g.LG(q5),Hs="PDE handleRefresh error",A instanceof Error&&(Hs="PDE handleRefresh error: "+A.message),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D_="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",A instanceof g.Li&&A.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D_="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),MA(Hs),q5.return(v6(X,
!1,void 0,u,D_,"DOWNLOAD_STATE_FAILED"))}})},FpC=function(D,X){var M,Q,h,H;
return g.r(function(t){if(t.S==1)return M=g.il(X.entityKey).entityId,Q=g.oL(M,"videoDownloadContextEntity"),g.I(t,zs(D.S,Q,"videoDownloadContextEntity"),2);h=t.G;return(H=h)!=null&&H.offlineModeType?t.return({offlineModeType:h.offlineModeType}):t.return(void 0)})},Vwr=function(D,X,M){var Q,h,H,t,q;
return g.r(function(w){if(w.S==1){if(!X.frameworkUpdates||!g.Z(X.frameworkUpdates,ft))return w.return();if(!(g.Z(X.frameworkUpdates,ft).mutations&&g.Z(X.frameworkUpdates,ft).mutations.length>0&&g.Z(X.frameworkUpdates,ft).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return w.D4(2);Q=g.il(g.Z(X.frameworkUpdates,ft).mutations[0].entityKey).entityId;return g.I(w,Sc(D.S,Q),3)}if(w.S!=2){h=w.G;H=g.Z(M.actionMetadata,gW);if(q=(t=H)==null?void 0:t.playlistId)h.playlistId=q;h.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.uS(D.j)?g.I(w,c6(Q,D.S,M,D.Y,h),2):g.RW(D.j)?g.I(w,EA(Q,D.S,M,D.Y),2):w.D4(2)}return g.I(w,ALa(g.Z(X.frameworkUpdates,ft)),0)})},v6=function(D,X,M,Q,h,H){return new IR(X?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",qA(D),M,Q,h,H)},B4b=function(D,X,M){X=mbr(D.j,M.cotn,X);
M=g.sN(X);return g.HFs(X,M,D.j)},ZmC=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a;
return g.r(function(F){if(F.S==1)return M=[],g.I(F,WV(D.S,{mode:"readonly",d3:!0},function(V){var c=[],S=X.offlineVideoStreams;if(S){S=g.e(S);for(var b=S.next();!b.done;b=S.next())c.push(OR(V,b.value,"offlineVideoStreams"))}return g.Bc.all(c)}),2);
if(Q=F.G)for(h=g.e(Q),H=h.next();!H.done;H=h.next())if(t=H.value,q=void 0,(q=t)==null?0:q.streamsProgress)for(w=t.streamsProgress,T=0;T<w.length;T++)L=w[T],K=JSON.parse(L.formatStreamBytes),a={itag:K.itag,lmt:K.lastModified,xtags:K.xtags},M.push(a);return F.return(M)})},c7K=function(D,X){this.S=D;
this.j=X},fiW=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F;
return g.r(function(V){switch(V.S){case 1:return M=qA(X),g.I(V,kh(D.S,"videoPlaybackPositionEntity"),2);case 2:Q=V.G;if(Q.length===0)return V.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));g.N_(V,3);return g.I(V,iV.getInstance(),5);case 5:h=V.G;if(!h)throw Error("prefStorage is undefined");return g.I(V,h.get("psi"),6);case 6:return H=V.G,w=(q=(t=H)==null?void 0:t.LT)!=null?q:"0",g.I(V,wLb(Q,w),7);case 7:return T=V.G,L={isPaused:T.watchHistoryPaused,LT:T.syncTimestampUsec},g.I(V,h.set("psi",
L),8);case 8:if(L.isPaused){V.D4(9);break}K=g.Z(T.frameworkUpdates,ft);if(!T.frameworkUpdates||!K){V.D4(9);break}return g.I(V,ALa(K),9);case 9:g.Ty(V,4);break;case 3:return a=g.LG(V),F="PPE handleRefresh error: "+(a instanceof Error?a.message:"unknown error"),MA(F),V.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return V.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},Edh=function(D,X){var M,Q,h,H,t,q,w,T;
return g.r(function(L){switch(L.S){case 1:return M=qA(X),Q=g.il(X.entityKey).entityId,g.N_(L,2),g.I(L,iV.getInstance(),4);case 4:h=L.G;if(!h)throw Error("prefStorage is undefined");return g.I(L,h.get("psi"),5);case 5:H=L.G;t=g.Z(X.actionMetadata,SsZ);if(((q=H)==null?void 0:q.isPaused)!==!1||(w=t)==null||!w.lastPlaybackPositionSeconds){L.D4(6);break}T={key:g.oL(Q,"videoPlaybackPositionEntity"),videoId:Q,lastPlaybackPositionSeconds:t.lastPlaybackPositionSeconds};return g.I(L,Gs(D.S,T,"videoPlaybackPositionEntity"),
6);case 6:g.Ty(L,3);break;case 2:return g.LG(L),L.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return L.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M))}})},y7h=function(D,X){var M,Q,h;
return g.r(function(H){switch(H.S){case 1:M=qA(X);g.N_(H,2);Q=g.il(X.entityKey).entityId;if(Q==="!*$_ALL_ENTITIES_!*$")return g.I(H,ipK(D.S),5);h=g.oL(Q,"videoPlaybackPositionEntity");return g.I(H,rL8(D.S,h),5);case 5:g.Ty(H,3);break;case 2:return g.LG(H),H.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},P$a=function(D,X){this.api=D;
this.S=X;this.logger=new g.KF("woffle");this.G=!1;this.py={MO:this.MO}},mNK=function(D){return g.r(function(X){return X.return(zdb(D))})},ndr=function(D){var X;
return g.r(function(M){if(M.S==1)return g.I(M,g.F1m(D),2);X=M.G;return M.return(X.filter(function(Q){return!!Q.url}).map(function(Q){return Q.url}))})},dW=function(D,X){var M=g.vU(X);
if(M===1||M===0)return Promise.resolve();(M=bmC(D,X))&&M.stopVideo();D.Y=0;return mNK(X)},rW=function(D,X,M,Q){M=M===void 0?!1:M;
Q=Q===void 0?!0:Q;X=typeof X==="string"?X:X.videoDetails.videoId;if(g.vU(X)===2){var h=bmC(D,X);h&&h.stopVideo();g.ds(X,2);D.Y=2;M?e2W(D.S):Q&&R28(D.S)}},bmC=function(D,X){var M;
return((M=D.player)==null?void 0:M.getVideoData().videoId)===X?D.player:null},Iiy=function(D,X){this.S=D;
this.j=X},vdy=function(D,X){var M,Q;
return g.r(function(h){switch(h.S){case 1:return M=qA(X),g.I(h,zs(D.S,X.entityKey,"transfer"),2);case 2:if(Q=h.G)return h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));g.N_(h,3);return g.I(h,gdG(D,X),5);case 5:g.Ty(h,4);break;case 3:return g.LG(h),h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},dNC=function(D,X){var M,Q;
return g.r(function(h){switch(h.S){case 1:return M=qA(X),g.I(h,zs(D.S,X.entityKey,"transfer"),2);case 2:Q=h.G;if(!Q||Q.transferState!=="TRANSFER_STATE_COMPLETE")return h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));g.N_(h,3);return g.I(h,gdG(D,X,!0),5);case 5:g.Ty(h,4);break;case 3:return g.LG(h),h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M))}})},r7C=function(D,X){var M,Q,h,H,t,q,w,T,L,K;
return g.r(function(a){switch(a.S){case 1:return M=qA(X),Q=g.il(X.entityKey).entityId,g.I(a,WV(D.S,{mode:"readonly",d3:!0},function(F){var V=OR(F,X.entityKey,"transfer");F=OR(F,g.oL(Q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Bc.all([V,F])}),2);
case 2:h=a.G;H=g.e(h);t=H.next().value;q=H.next().value;w=t;T=q;if(!w||w.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return a.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));g.N_(a,3);w.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.I(a,Gs(D.S,w,"transfer"),5);case 5:L=g.il(w.key).entityId;c2b({videoId:L,Qj:w,offlineModeType:(K=T)==null?void 0:K.offlineModeType});g.Ty(a,4);break;case 3:return g.LG(a),a.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return a.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M))}})},gdG=function(D,X,M){M=M===void 0?!1:M;
var Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b;return g.r(function(n){switch(n.S){case 1:return Q=g.Z(X.actionMetadata,imK),h=g.il(X.entityKey).entityId,H=g.oL(h,"downloadStatusEntity"),g.I(n,WV(D.S,{mode:"readonly",d3:!0},function(R){var v=OR(R,H,"downloadStatusEntity");R=OR(R,g.oL(h,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Bc.all([v,R])}),2);
case 2:return t=n.G,q=g.e(t),w=q.next().value,T=q.next().value,L=w,K=T,a="TRANSFER_STATE_TRANSFER_IN_QUEUE",((F=L)==null?void 0:F.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(a="TRANSFER_STATE_PAUSED_BY_USER"),S={key:X.entityKey,transferState:a,cotn:g.sB(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(V=Q)==null?void 0:V.maximumDownloadQuality,preferredAudioTrack:(c=Q)==null?void 0:c.preferredAudioTrack,transferRetryCount:0,isRefresh:M,hasLoggedFirstStarted:!1},g.I(n,WV(D.S,
{mode:"readwrite",d3:!0},function(R){var v=[];M&&v.push(lV(R,g.oL(h,"offlineVideoStreams")));v.push(Yh(R,S,"transfer"));return g.Bc.all(v)}),3);
case 3:if(!M){n.D4(4);break}return g.I(n,mNK(h),4);case 4:ZPh({videoId:h,Qj:S,offlineModeType:(b=K)==null?void 0:b.offlineModeType}),g.HZ(n)}})},C$8=function(D,X,M,Q){if(!D.action.entityKey)throw Error("entityKey is missing.");
var h=g.il(D.action.entityKey);h={entityType:h.CX,entityId:h.entityId,offlineOrchestrationActionType:D.action.actionType,orchestrationAction:{orchestrationActionId:D.actionId}};X&&(h.offlineOrchestrationActionResult=X.status,h.isRetryable=M?!1:X.S,X.Y&&(h.offlineOrchestrationFailureReason=odZ(X.Y,h.isRetryable)));var H,t;if((H=D.action.actionMetadata)==null?0:(t=H.offlineLoggingData)==null?0:t.offlineModeType)h.offlineModeType=D.action.actionMetadata.offlineLoggingData.offlineModeType;Q&&(h.additionalOrchestrationActions=
Q.map(function(q){return{orchestrationActionId:q.actionId}}));
return h},odZ=function(D,X){return D!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||X?D==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&X?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":D:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},OmB=function(D,X){var M={offlineOrchestrationContext:C$8(D)};
X=Qcy(X,M);hiK(MnC(),X,D.rootActionId)},pLh=function(D,X,M,Q){Q=Q===void 0?[]:Q;
X={offlineOrchestrationContext:C$8(D,X,M,Q)};X=Qcy(3,X);hiK(MnC(),X,D.rootActionId)},A7W=function(){this.actions=[]},Ysr=function(D,X){X=g.e(X);
for(var M=X.next();!M.done;M=X.next())M=M.value,OmB(M,1),D.actions.push(M);D.actions.sort(D.S)},liZ=function(D,X){if(X)for(var M=0;M<D.actions.length;M++)if(X==="!*$_ALL_ENTITIES_!*$"&&D.actions[M].actionId!==X||X!=="!*$_ALL_ENTITIES_!*$"&&D.actions[M].rootActionId===X&&D.actions[M].actionId!==X)D.actions.splice(M,1),M--},J7_=function(D,X){D=g.e(D.actions);
for(var M=D.next();!M.done;M=D.next())if(M.value.actionId===X)return!0;return!1},io=function(D,X,M,Q,h){g.O.call(this);
var H=this;this.G=D;this.a5=X;this.f$=M;this.J=Q;this.j=h;this.S=new A7W;this.X=new g.O6;this.Y=new g.W5(function(){H.retry()});
this.K=NaN;this.D=!1;this.py={DP4:function(){return H.S},
YS:function(){return H.X},
uus:function(){return H.Y},
retry:function(){return H.retry()}};
g.p(this,this.Y);this.eH=this.G.observe(this.R5.bind(this))},GV_=function(D,X,M,Q,h){var H;
return g.r(function(t){if(t.S==1)return H=new io(D,X,M,Q,h),g.I(t,xNG(H),2);WpW(H);return t.return(H)})},WpW=function(D){var X=D.S.actions[0];
return D.U?((X==null?void 0:X.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&D.U[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(D.D=!0),Promise.resolve()):z2r(D)},z2r=function(D){var X,M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b;
return g.r(function(n){switch(n.S){case 1:if(D.U)throw Error("Already processing an action");if(D.H2())return n.return();X=D.S.actions.shift();$bZ(D.f$,!X);if(X===void 0)return n.return();X.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&X.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&liZ(D.S,X.actionId);M="";X.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&X.rootActionId===X.actionId&&(M=X.actionId);Q=[X];D.U=Q;if(h=D.a5[X.entityType]){n.D4(2);break}D.U=
void 0;return g.I(n,z2r(D),3);case 3:return n.return();case 2:H=g.e(Q);for(t=H.next();!t.done;t=H.next())q=t.value,OmB(q,2);g.N_(n,4,5);return g.I(n,Kph(h,Q.map(function(R){return R.action})),7);
case 7:w=n.G,T=g.e(Q),L=T.next();case 8:if(L.done){n.D4(10);break}K=L.value;a=w.get(K.action);return g.I(n,kVC(D,K,a),9);case 9:L=T.next();n.D4(8);break;case 10:liZ(D.S,M);case 5:g.s8(n);D.U=void 0;g.KG(n,6);break;case 4:return F=g.LG(n),MA("Orchestration error",F),g.N_(n,12),g.I(n,ugr(D,Q),14);case 14:g.Ty(n,5);break;case 12:V=g.LG(n);MA("Orchestration retry error",V);c=g.e(Q);for(S=c.next();!S.done;S=c.next())b=S.value,b.retryScheduleIndex<3&&Ysr(D.S,[b]);n.D4(5);break;case 6:return g.I(n,z2r(D),
0)}})},kVC=function(D,X,M){var Q,h,H,t,q,w,T,L,K,a,F,V;
return g.r(function(c){switch(c.S){case 1:Q=X.retryScheduleIndex+2===3;if(M.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){c.D4(2);break}if(M.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){c.D4(0);break}pLh(X,M,Q);if(M.S&&X.retryScheduleIndex+1<3)return g.I(c,ugr(D,[X]),0);H=((h=M)==null?0:h.G)?M.G:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";t={entityKey:X.action.entityKey,failureReason:H};q=void 0;g.uS(D.j)?q="mainVideoDownloadStateEntity":g.RW(D.j)&&(q="musicTrackDownloadMetadataEntity");
if(!q||!M.downloadState){c.D4(7);break}w=g.il(X.action.entityKey).entityId;return g.I(c,sA(w,q,D.G,M.downloadState),7);case 7:hZ(D.J,t);if(M.downloadState==="DOWNLOAD_STATE_FAILED"&&D.j.T("html5_auto_retry_failed_pde_actions")){c.D4(0);break}MA("Orchestration result is not retryable, deleting action");return g.I(c,rL8(D.G,B6(X).key),0);case 2:T=void 0;try{T=(L=M.U)==null?void 0:L.map(function(S){return D.createAction(S,X)})}catch(S){return pLh(X,M,Q),K={entityKey:X.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},hZ(D.J,K),MA("Orchestration subactions creation error",S),c.return()}pLh(X,M,Q,T);if(!T){c.D4(12);break}a=T.map(function(S){return B6(S)});
F=0;case 13:if(!(F<T.length)||D.D){c.D4(15);break}return g.I(c,WV(D.G,{mode:"readwrite",d3:!0},function(S){var b=[];b.push(PGW(S,a.slice(F,F+10),"offlineOrchestrationActionWrapperEntity"));return g.Bc.all(b)}),16);
case 16:F+=10;c.D4(13);break;case 15:if(D.D)return D.D=!1,c.return();case 12:return V=B6(X),g.I(c,rL8(D.G,V.key),17);case 17:OmB(X,4),g.HZ(c)}})},MIW=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F;
return g.r(function(V){M=[];Q=Infinity;h=4E3;H=g.e(X);for(t=H.next();!t.done;t=H.next())q=t.value,w=Number(q.enqueueTimeSec),T=j3K(w),L=q.retryScheduleIndex,K=L!=null&&L>0,T>0&&K?(Q=Math.min(Q,w),h=Math.min(T,h)):M.push(q);isFinite(Q)&&(!D.Y.isActive()||Q<D.K)&&(D.K=Q,D.Y.start(h));D.X.Yh()||(a=M.length,M=M.filter(function(c){var S;c=((S=c.actionProto)==null?void 0:S.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Dma.includes(c)}),F=M.length<a,!D.Y.isActive()&&F&&D.Y.start(1));
M.length>0&&XPh(D,M);return g.I(V,WpW(D),0)})},hJG=function(D){var X,M,Q,h,H,t,q;
return g.r(function(w){if(w.S==1)return g.I(w,Q7B(D),2);X=w.G;M=[];Q=g.e(X);for(h=Q.next();!h.done;h=Q.next())H=h.value,t=g.il(H.key),q=t.entityId,J7_(D.S,q)||M.push(H);return g.I(w,MIW(D,M),0)})},j3K=function(D){D=D*1E3-Date.now();
return D>4E3?4E3:D},ugr=function(D,X){var M,Q,h;
return g.r(function(H){M=g.e(X);for(Q=M.next();!Q.done;Q=M.next()){h=Q.value;var t=void 0,q=void 0,w=((q=h.action)==null?void 0:(t=q.actionMetadata)==null?void 0:t.retryScheduleIntervalsInSeconds)||[1,2,4];t=1;h.retryScheduleIndex<w.length&&(t=w[h.retryScheduleIndex]);h.S=t*1E3+Date.now();h.retryScheduleIndex++}return g.I(H,HsC(D,X),0)})},xNG=function(D){var X;
return g.r(function(M){if(M.S==1)return g.I(M,kh(D.G,"offlineOrchestrationActionWrapperEntity"),2);X=M.G;return g.I(M,MIW(D,X),0)})},XPh=function(D,X){X.length!==0&&X.forEach(function(M){M=$b(M);
M.retryScheduleIndex<3&&Ysr(D.S,[M])})},Q7B=function(D,X){var M;
return g.r(function(Q){if(Q.S==1)return g.I(Q,kh(D.G,"offlineOrchestrationActionWrapperEntity",X),2);M=Q.G;return Q.return(M.filter(YXr))})},HsC=function(D,X){if(X.length===0)return Promise.resolve([]);
X=X.map(function(M){return B6(M)});
return doy(D.G,X)},tIG=function(D){this.XF=D;
this.S=void 0},N3a=function(D,X){var M,Q,h,H;
return g.r(function(t){M=X.videoId;Q=!0;if(X.captionTracks.length)h=VZh(X),D.S=new g.Kb(D.XF,X,h);else if(X.J5)H=g.nsp(X),D.S=new g.Fx(D.XF,X.J5,M,H,X.EU,X.eventId),Q=X.EU;else return t.return();return t.return(new Promise(function(q){var w;(w=D.S)==null||w.yI({Ra:function(){return g.r(function(T){if(T.S==1)return g.I(T,D.Ra(M,Q),2);q();g.HZ(T)})},
uR:function(){}})}))})},qyh=function(D){var X;
return g.r(function(M){if(M.S==1)return g.I(M,Gk_(D),2);X=M.G;return M.return(!!X&&X.length>0)})},oR=function(D){g.O.call(this);
this.S=D;this.G=this.S.observe(this.Y.bind(this))},wPt=function(D,X){var M,Q,h,H,t,q,w;
return g.r(function(T){switch(T.S){case 1:if(X.length===0)return T.return([]);M=X.map(function(L){return g.oL(L,"transfer")});
return g.I(T,kh(D.S,"transfer",M),2);case 2:Q=T.G;h=Q.filter(YXr).map(function(L){return g.il(L.key).entityId});
H=X.filter(function(L){return h.indexOf(L)===-1});
if(H.length===0)return T.return([]);t=g.e(H);q=t.next();case 3:if(q.done){T.D4(5);break}w=q.value;return g.I(T,mNK(w),4);case 4:q=t.next();T.D4(3);break;case 5:return T.return(H)}})},s7K=function(D,X,M,Q,h,H){var t,q,w;
return g.r(function(T){t="STREAM_TYPE_UNKNOWN";M.video&&M.audio?(t="STREAM_TYPE_AUDIO_AND_VIDEO",MA("unexpected stream type")):M.video&&!M.audio?t="STREAM_TYPE_VIDEO":!M.video&&M.audio&&(t="STREAM_TYPE_AUDIO");q=g.oL(X,"offlineVideoStreams");w={numBytesDownloaded:h.toFixed(),numTotalBytes:H.toFixed(),streamType:t,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(Q),itag:t==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(M.itag):void 0};return g.I(T,WV(D,{mode:"readwrite",d3:!0},
function(L){var K=OR(L,q,"offlineVideoStreams"),a=OR(L,g.oL(X,"transfer"),"transfer");return g.Bc.all([K,a]).then(function(F){F=g.e(F);var V=F.next().value;F=F.next().value;if(!F)return lV(L,q).then(function(){});
var c=T3C(V);V=L$B(V,Q,w,q);var S=Yh(L,V,"offlineVideoStreams");T3C(V)>c&&(F.lastProgressTimeMs=Date.now().toString());c=[S];F.offlineVideoStreams||(F.offlineVideoStreams=[]);F.offlineVideoStreams.indexOf(q)===-1&&(F.offlineVideoStreams.push(q),c.push(Yh(L,F,"transfer")));return g.Bc.all(c)})}),0)})},K$h=function(D,X){var M,Q,h,H,t;
return g.r(function(q){if(q.S==1)return M=g.oL(X,"offlineVideoStreams"),g.I(q,zs(D,M,"offlineVideoStreams"),2);Q=q.G;if(!Q||!Q.streamsProgress)return q.return();h=g.e(Q.streamsProgress);for(H=h.next();!H.done;H=h.next())t=H.value,t.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",t.numTotalBytes!==t.numBytesDownloaded&&(t.numBytesDownloaded=t.numTotalBytes);return g.I(q,Gs(D,Q,"offlineVideoStreams"),0)})},L$B=function(D,X,M,Q){if(D&&D.streamsProgress){Q=D;
a:{X=X.itag+";"+X.xtags;for(var h=D.streamsProgress,H=0;H<h.length;H++){var t=JSON.parse(h[H].formatStreamBytes);if(t.itag+";"+t.xtags===X){h[H]=M;M=h;break a}}h.push(M);M=h}Q.streamsProgress=M}else D={key:Q,streamsProgress:[M]};return D},T3C=function(D){if(D==null?0:D.streamsProgress){var X=0;
D=D.streamsProgress;for(var M=0;M<D.length;M++){var Q=D[M];isNaN(Number(Q.numBytesDownloaded))?MA("stream progress bytes number invalid"):X+=Number(Q.numBytesDownloaded)}return X}return 0},aub=function(D,X,M,Q){g.O.call(this);
var h=this;this.G=D;this.api=X;this.OR=M;this.R5=Q;this.X=new g.O6;this.U=new g.W5(function(){h.S&&h.S.transferState==="TRANSFER_STATE_TRANSFERRING"&&h.X.Yh()&&((h.S.transferRetryCount||0)<3?rW(h.J,h.D,!1,!1):dW(h.J,h.D.videoDetails.videoId),h.aL("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.f$=this.L$=0;this.eH=this.K=!1;this.A$=g.lx(this.api.W().experiments,"html5_transfer_processing_logs_interval");this.yf=new g.HE(this);this.py={Ji2:function(){return h.U},
R12:function(){return h.R5},
YS:function(){return h.X}};
this.a5=this.G.observe(this.iU.bind(this));this.J=new P$a(X,this);this.t$=new tIG(X);this.sR=new oR(this.G);this.uj=this.X.listen("publicytnetworkstatus-online",this.TU.bind(this));this.M5=this.X.listen("publicytnetworkstatus-offline",this.K3H.bind(this));this.eH=this.api.W().T("html5_less_transfer_processing_logs");g.p(this,this.yf);this.yf.N(X,"offlinetransferpause",this.VVF);if(g.uS(this.api.W()))this.Y="mainVideoDownloadStateEntity";else if(g.RW(this.api.W())||g.Dk(this.api.W()))this.Y="musicTrackDownloadMetadataEntity"},
F$W=function(D){return g.r(function(X){if(X.S==1)X=g.I(X,xon(),2);
else{var M=D.sR;var Q=g.gs();Q=Object.keys(Q);M=wPt(M,Q);X=g.I(X,M,0)}return X})},OA=function(D,X){X=X===void 0?!1:X;
var M;return g.r(function(Q){if(Q.S==1){if(D.S)throw Error("Already downloading a video");D.f$=0;D.K=!1;return g.I(Q,VIh(D),2)}return Q.S!=4?(M=Q.G,BgK(D.OR,!M),M&&D.X.Yh()?X?g.I(Q,new Promise(function(h){g.Vj(h,1E3)}),4):Q.D4(4):(!M&&D.S&&Ct(D),Q.D4(0))):g.I(Q,$mt(D,M),0)})},B3W=function(D){return g.r(function(X){if(X.S==1)return D.D?g.I(X,dW(D.J,D.D.videoDetails.videoId),3):X.D4(0);
Ct(D);g.HZ(X)})},ZsK=function(D,X){var M,Q,h;
return g.r(function(H){switch(H.S){case 1:return g.N_(H,2),(M=!!X.captionTracks.length||!!X.J5)?g.I(H,qyh(X.videoId),4):H.return();case 4:return(Q=H.G)?H.return():g.I(H,N3a(D.t$,X),5);case 5:g.Ty(H,0);break;case 2:h=g.LG(H),MA("Caption downloading error",h,X.cotn),g.HZ(H)}})},$mt=function(D,X){var M,Q,h,H,t,q;
return g.r(function(w){switch(w.S){case 1:if(D.K)return w.return();D.K=!0;D.S=X;M=g.il(D.S.key);Q=M.entityId;h=void 0;if(D.S.transferState==="TRANSFER_STATE_TRANSFERRING")return g.I(w,pt(D,Q),7);if(D.S.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||D.S.transferRetryCount||D.S.hasLoggedFirstStarted){w.D4(3);break}return g.I(w,pt(D,Q),5);case 5:return h=w.G,D.S.hasLoggedFirstStarted=!0,g.I(w,UmW(D),6);case 6:Ubn({videoId:Q,Qj:D.S,offlineModeType:h},void 0,void 0,!0);w.D4(3);break;case 7:h=w.G,
NA({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:Q,Qj:D.S,offlineModeType:h});case 3:return g.I(w,cib(D),8);case 8:return H=null,g.N_(w,9),g.I(w,fuB(D,X),11);case 11:H=w.G;D.D=H;g.Ty(w,10);break;case 9:return t=g.LG(w),MA("error getting player response",t,X.cotn),g.I(w,D.aL("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return w.return();case 10:return q=mbr(D.api.W(),X.cotn,H),g.I(w,ZsK(D,q),13);case 13:return g.I(w,ndr(q.videoId),
14);case 14:q.XV=w.G;var T=D.J,L=q,K=X.maximumDownloadQuality;L.getPlayerResponse();g.ds(L.videoId,2);T.Y=2;T.G=!1;var a;(a=T.player)==null||a.dispose();T.player=T.api.fU(L);L={};T.player.Dq((L.localmediachange=T.Gi,L.signatureexpired=T.UO,L.statechange=T.xxf,L),T);T.T("html5_generate_content_po_token")&&T.player.VU();K=T.MO(K);T.player.wB(g.mm(K,K,!0,"m"),!1);T.player.hn(!1);D.U.start(108E5);g.HZ(w)}})},VIh=function(D){var X,M;
return g.r(function(Q){if(Q.S==1)return g.I(Q,kh(D.G,"transfer"),2);X=Q.G;M=X.filter(SyK).sort(E1h);return M.length===0?Q.return():Q.return(M[0])})},cib=function(D){var X,M,Q;
return g.r(function(h){if(h.S==1){if(!D.S)return AZ(D,"onTransferStart"),h.return();D.U.start(108E5);return g.I(h,Yb(D,"TRANSFER_STATE_TRANSFERRING"),2)}X=D.S;return(Q=((M=X)==null?0:M.key)?g.il(X.key).entityId:"")&&D.Y?g.I(h,sA(Q,D.Y,D.G,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):h.D4(0)})},e2W=function(D){var X,M,Q,h;
g.r(function(H){switch(H.S){case 1:if(!D.S){AZ(D,"onTransferPausedByUser");H.D4(2);break}X=D.S;D.U.stop();return g.I(H,Yb(D,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:Q=((M=X)==null?0:M.key)?g.il(X.key).entityId:"";if(!Q||!D.Y){H.D4(4);break}return g.I(H,sA(Q,D.Y,D.G,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.I(H,pt(D,Q),6);case 6:h=H.G,fTG({videoId:Q,Qj:X,offlineModeType:h});case 2:Ct(D),OA(D),g.HZ(H)}})},R28=function(D){var X,M,Q;
g.r(function(h){if(h.S==1){if(!D.S)return AZ(D,"onTransferPausedByNetwork"),h.return();D.U.stop();return g.I(h,Yb(D,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(h.S!=3)return X=D.S,(Q=((M=X)==null?0:M.key)?g.il(X.key).entityId:"")&&D.Y?g.I(h,sA(Q,D.Y,D.G,"DOWNLOAD_STATE_PAUSED"),3):h.D4(3);Ct(D);g.HZ(h)})},yiG=function(D){var X,M,Q,h,H;
g.r(function(t){switch(t.S){case 1:if(!D.S)return AZ(D,"onTransferComplete"),t.return();X=D.S;D.U.stop();if(!X||!D.D){t.D4(2);break}M=mbr(D.api.W(),X.cotn,D.D);return g.I(t,ZsK(D,M),2);case 2:return g.I(t,Yb(D,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:h=((Q=X)==null?0:Q.key)?g.il(X.key).entityId:"";if(!h||!D.Y){t.D4(5);break}return g.I(t,sA(h,D.Y,D.G,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.I(t,K$h(D.G,h),7);case 7:return g.I(t,pt(D,h),8);case 8:H=t.G,NA({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:h,Qj:X,offlineModeType:H}),Ct(D),OA(D),g.HZ(t)}})},Ptn=function(D,X,M){var Q,h;
g.r(function(H){switch(H.S){case 1:if(!D.S)return AZ(D,"onTransferProgress: "+X),H.return();if(D.S.transferState==="TRANSFER_STATE_TRANSFERRING"){H.D4(2);break}return g.I(H,cib(D),2);case 2:Q=Date.now();if(!(Q-D.L$>1E3)){H.D4(4);break}D.L$=Q;return g.I(H,s7K(D.G,M.videoId,M.G,M.al,M.bytesDownloaded,M.S),5);case 5:if(D.eH&&!(D.eH&&Q-D.f$>D.A$)){H.D4(4);break}D.f$=Q;return g.I(H,pt(D,X),7);case 7:h=H.G,Ubn({videoId:X,Qj:D.S,offlineModeType:h},M.bytesDownloaded,M.S);case 4:D.U.start(108E5),g.HZ(H)}})},
mmb=function(D){var X=(D.S.transferRetryCount||0)<3;
X&&(D=D.S,D.transferRetryCount=(D.transferRetryCount||0)+1);return X},n1Z=function(D,X){X=X===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":X;
var M,Q,h,H;return g.r(function(t){if(t.S==1)return D.S||AZ(D,"setTransferToFailed: "+X),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X==="TRANSFER_FAILURE_REASON_NETWORK"?M="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":X==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.I(t,Yb(D,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",X),2);if(t.S!=3)return hZ(D.R5,{entityKey:(Q=D.S)==null?void 0:Q.key,failureReason:M}),
h=D.S?g.il(D.S.key).entityId:"",g.I(t,pt(D,h),3);H=t.G;var q={videoId:h,Qj:D.S,offlineModeType:H},w=X,T={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};w&&(T.transferFailureReason=w,T.failureReason=S$C(w));NA(T,q);g.HZ(t)})},Yb=function(D,X,M,Q){var h;
return g.r(function(H){if(H.S==1){if(!D.S)return AZ(D,"saveTransferState: "+X),H.return();D.S.transferState=X;D.S.failureReason=Q;g.N_(H,2);return g.I(H,UmW(D,function(t){return M?ph(t,"offlineVideoStreams",D.S.offlineVideoStreams).then(function(q){for(var w=g.e(q),T=w.next();!T.done;T=w.next())if((T=T.value)&&T.streamsProgress){T=g.e(T.streamsProgress);for(var L=T.next();!L.done;L=T.next())L.value.streamState=M}return PGW(t,q.filter(function(K){return!!K}),"offlineVideoStreams")}):g.Bc.resolve(void 0)}),
4)}if(H.S!=2)return g.Ty(H,0);
h=g.LG(H);return h instanceof g.Li&&h.type==="QUOTA_EXCEEDED"?g.I(H,D.aL("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):H.D4(0)})},UmW=function(D,X){var M;
return g.r(function(Q){if(!D.S)return Q.return();M=D.S;return g.I(Q,WV(D.G,{mode:"readwrite",d3:!0},function(h){var H=[Yh(h,M,"transfer")];X&&H.push(X(h));return g.Bc.all(H)}),0)})},Ct=function(D){D.S=void 0;
D.D=void 0;D.U.stop()},fuB=function(D,X){var M,Q,h,H,t;
return g.r(function(q){if(q.S==1)return M=g.il(X.key),Q=M.entityId,h=g.oL(Q,"playbackData"),g.I(q,zs(D.G,h,"playbackData"),2);H=q.G;if((t=H)==null?0:t.playerResponseJson)return q.return(JSON.parse(H.playerResponseJson));throw Error("No PlayerResponse found");})},AZ=function(D,X){D.api.SH("woffle",{mcte:X});
MA("missing current transfer entity.")},pt=function(D,X){var M,Q,h;
return g.r(function(H){if(H.S==1)return g.I(H,zs(D.G,g.oL(X,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);M=H.G;return H.return((h=(Q=M)==null?void 0:Q.offlineModeType)!=null?h:void 0)})},SyK=function(D){return bsG[D.transferState]!==void 0},E1h=function(D,X){var M=bsG[D.transferState],Q=bsG[X.transferState];
return M!==Q?M-Q:Number(D.enqueuedTimestampMs)-Number(X.enqueuedTimestampMs)},lo=function(D,X){var M=this;
this.j=D;this.api=X;this.X=new g.O6;this.D=new g.wh;this.py={fE:function(){return M.Y.py.fE()},
YS:function(){return M.X},
GoI:function(){return M.Y},
vY:function(){return M.vY()},
Xb:function(){return M.Xb()},
JH:function(){return M.JH()},
o7:function(){return M.o7()},
I7:function(){return M.I7()},
tB:function(Q){return M.tB(Q)}};
this.Y=new aTB(function(){return eJC(M)},function(){M.JH()},this.api.qW(),this.api.T.bind(this.api));
this.S=new QT(this.api);FdZ(this.Y)},eJC=function(D){return g.r(function(X){D.api.ER("onOrchestrationBecameLeader");
return g.I(X,D.Xb(),0)})},Iua=function(D){var X,M;
return g.r(function(Q){if(Q.S==1)return g.I(Q,uV(),2);if(Q.S!=3){X=Q.G;if(!X)return MA("PES is undefined"),Q.return();D.G=new aub(X,D.api,D.Y,D.S);M=D.Ak(X);return g.I(Q,GV_(X,M,D.Y,D.S,D.j),3)}D.J=Q.G;return g.I(Q,RJa(D),0)})},RJa=function(D){var X;
return g.r(function(M){switch(M.S){case 1:if(!D.G)return MA("transferManager is undefined"),M.return();if(D.G.S){M.D4(2);break}return g.I(M,OA(D.G),2);case 2:if(!D.j.T("woffle_enable_main_downloads_library")){M.D4(4);break}return g.I(M,D.nx(),4);case 4:if(!D.j.T("html5_offline_playback_position_sync")){M.D4(6);break}return g.I(M,D.gE(),7);case 7:return g.I(M,D.tB(864E5),6);case 6:return g.I(M,D.refreshAllStaleEntities(43200,!0),9);case 9:return g.I(M,D.Rc(),10);case 10:if(!D.j.T("html5_retry_downloads_for_expiration")){M.D4(11);
break}return g.I(M,D.I7(),11);case 11:return D.K=g.$H(function(){D.refreshAllStaleEntities(43200,!0);D.Rc()},9E5),g.zj(g.u2(),function(){return D.o7()}),g.I(M,uV(),13);
case 13:return X=M.G,g.I(M,KdB(X),14);case 14:Vn_(D.Y),g.HZ(M)}})},g1t=function(){var D,X,M,Q,h,H;
return g.r(function(t){switch(t.S){case 1:return g.I(t,uV(),2);case 2:D=t.G;if(!D)return t.return([]);X=Date.now()/1E3;return g.I(t,kh(D,"offlineVideoPolicy"),3);case 3:M=t.G,Q=g.e(M),h=Q.next();case 4:if(h.done){t.D4(6);break}H=h.value;if(!(H.expirationTimestamp&&Number(H.expirationTimestamp)<X)){t.D4(5);break}H.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";H.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.I(t,Gs(D,H,"offlineVideoPolicy"),5);
case 5:h=Q.next();t.D4(4);break;case 6:return t.return(M.map(function(q){return q.key}))}})},JZ=function(D,X,M,Q,h){var H,t,q;
return g.r(function(w){if(w.S==1)return g.I(w,uV(),2);H=w.G;if(!H)return w.return([]);t=X.map(function(T){var L=g.oL(T,M);L={actionType:Q,entityKey:L,actionMetadata:Object.assign({},nqr(),h)};Q!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(L.actionMetadata.priority=0);T=new VT(M,T,L);return B6(T)});
q=doy(H,t);FdZ(D.Y);return w.return(q)})},v1n=function(D,X,M,Q){var h,H,t,q,w,T,L,K;
return g.r(function(a){switch(a.S){case 1:h=[],H=g.e(X),t=H.next();case 2:if(t.done){a.D4(4);break}q=t.value;if(q.upToDate||M&&!q.shouldAutoSyncMetadata||!q.playlistId){a.D4(3);break}w={};switch(Q){case "mainPlaylistEntity":T={nextAutoRefreshIntervalSeconds:q.checkInSeconds,autoSync:M};w={mainPlaylistEntityActionMetadata:T};break;case "musicPlaylist":L={autoSync:M},w={musicPlaylistEntityActionMetadata:L}}return g.I(a,JZ(D,[q.playlistId],Q,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",w),6);case 6:(K=
a.G)&&h.push.apply(h,g.xW(K));case 3:t=H.next();a.D4(2);break;case 4:return a.return(h)}})},dmC=function(D,X){var M;
return g.r(function(Q){return X.length?(M=nqr(),g.RO(M,gW,{isEnqueuedForExpiredStreamUrlRefetch:!0}),D.api.SH("qrd",{v:X.length}),Q.return(JZ(D,X,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M))):Q.return([])})},riy=function(D,X,M){this.S=D;
this.j=X;this.Y=M},Cth=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n;
return g.r(function(R){switch(R.S){case 1:return M=qA(X),Q=g.il(X.entityKey),h=Q.entityId,H=[],g.N_(R,2),g.I(R,isZ(D,h),4);case 4:H=R.G;if(!(D.j.T("woffle_enable_main_downloads_library")&&((t=H)==null?0:t.length))){R.D4(5);break}return g.I(R,pSn(D.S,[X.entityKey]),5);case 5:g.Ty(R,3);break;case 2:return q=g.LG(R),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.Li&&q.type==="QUOTA_EXCEEDED"?(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):MA("Playlist add error"),R.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,w,T));case 3:L=[];if(!D.j.T("html5_offline_prevent_redownload_downloaded_video")){R.D4(7);break}return g.I(R,P0G(D.S,"mainVideoEntity",H),8);case 8:H=R.G;case 7:if((K=H)==null?0:K.length)for(a=g.e(H),F=a.next();!F.done;F=a.next())if(V=F.value,c=V.offlineVideoData,S=void 0,(S=c)==null?0:S.videoId)b=void 0,n=Number(((b=X.actionMetadata)==null?void 0:b.priority)||
0)+1,L.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c.videoId,"mainVideoEntity",n,xb,o1h(X,c,h)));return R.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,L))}})},pPh=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs,S2,XC,q_,th,Jd,Gp,zy,Ra,m,$B,WZ,wR,eb,E,Xn,ci,qu,Wi,wS,zp,Dt,Pi,P,f,y,d,W,N5,z,J,C,Ri,Ii,Z_,b1,Qh,mH,pf,vi,kB,e2,CR,gR,Sb,Co,SF,yh;
return g.r(function(uW){switch(uW.S){case 1:return M=qA(X),Q=X.entityKey,h=g.il(Q).entityId,H=[],t=!1,h==="!*$_ALL_ENTITIES_!*$"?(t=!0,g.I(uW,kh(D.S,"mainPlaylistEntity"),5)):g.I(uW,zs(D.S,Q,"mainPlaylistEntity"),4);case 4:(q=uW.G)&&H.push(q);uW.D4(3);break;case 5:H=uW.G;case 3:if((w=H)==null||!w.length)return uW.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));T=g.Z(X.actionMetadata,Osh);K=(L=T)==null?void 0:L.nextAutoRefreshIntervalSeconds;F=(a=T)==null?void 0:a.autoSync;V=[];S=c=
!0;b=!1;if(!t&&F===!1){uW.D4(6);break}g.N_(uW,7);return g.I(uW,MwC(0,!!F,!0,H),9);case 9:V=uW.G;g.Ty(uW,8);break;case 7:n=g.LG(uW);if(!(n instanceof Error&&n.message==="No data")){n instanceof Error&&n.message==="Empty response body"&&MA(n.message);uW.D4(8);break}return h==="!*$_ALL_ENTITIES_!*$"?g.I(uW,dbn(D.S,X,D.Y,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.I(uW,gqZ(h,D.S,X,D.Y),8);case 8:if(!V.length||!t&&V[0].playlistId!==h)return uW.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M));case 6:if(t){R=[];v=g.e(V);for(l=v.next();!l.done;l=v.next())A=l.value,A.upToDate||F&&!A.shouldAutoSyncMetadata||!A.playlistId||(Hs={nextAutoRefreshIntervalSeconds:A.checkInSeconds,autoSync:F},R.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",A.playlistId,"mainPlaylistEntity",0,xb,{mainPlaylistEntityActionMetadata:Hs})));return uW.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,R))}V.length&&(u=V[0],b=!!u.upToDate,F&&(c=(D_=u.shouldAutoSyncMetadata)!=null?D_:!0,S=(q5=u.shouldAutoSyncVideos)!=
null?q5:!0,u.checkInSeconds&&(K=u.checkInSeconds)));if(b||!c)return uW.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));Lo=[];Qs=H[0];if(!Qs.downloadState){S2=void 0;uW.D4(15);break}return g.I(uW,zs(D.S,Qs.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:S2=uW.G;case 15:return XC=S2,th=((q_=XC)==null?0:q_.addedTimestampMillis)?String(XC.addedTimestampMillis):void 0,g.N_(uW,17),g.I(uW,isZ(D,h,th,K),19);case 19:Lo=uW.G;g.Ty(uW,18);break;case 17:Jd=g.LG(uW);if(!(Jd instanceof
Error&&Jd.message==="No data for playlist")){if(Jd instanceof Error&&Jd.message==="Empty response body for playlist")MA(Jd.message);else return Gp="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",zy="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Jd instanceof g.Li&&Jd.type==="QUOTA_EXCEEDED"&&(Gp="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",zy="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),uW.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,Gp,zy));
uW.D4(18);break}return g.I(uW,gqZ(h,D.S,X,D.Y),18);case 18:if(!S)return uW.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));Ra=[];m=new Map;if(($B=Lo)==null?0:$B.length)for(WZ=g.e(Lo),wR=WZ.next();!wR.done;wR=WZ.next())eb=wR.value,E=eb.offlineVideoData,Xn=void 0,((Xn=E)==null?0:Xn.videoId)&&m.set(E.videoId,E);ci=new Map;qu=[];if((Wi=Qs)==null?0:(wS=Wi.videos)==null?0:wS.length)for(zp=g.e(Qs.videos),Dt=zp.next();!Dt.done;Dt=zp.next())if(Pi=Dt.value,P=JSON.parse(g.il(Pi).entityId),f=
P.videoId)m.has(f)?(ci.set(f,m.get(f)),m.delete(f)):qu.push(f);d=Number(((y=X.actionMetadata)==null?void 0:y.priority)||0)+1;W=g.e(m.entries());for(N5=W.next();!N5.done;N5=W.next())z=N5.value,J=g.e(z),C=J.next().value,Ri=J.next().value,Ii=C,Z_=Ri,Ra.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Ii,"mainVideoEntity",d,xb,o1h(X,Z_,h)));b1=g.e(ci.entries());for(Qh=b1.next();!Qh.done;Qh=b1.next())mH=Qh.value,pf=g.e(mH),vi=pf.next().value,kB=pf.next().value,e2=vi,CR=kB,Ra.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
e2,"mainVideoEntity",d,xb,o1h(X,CR,h)));gR=g.e(qu);for(Sb=gR.next();!Sb.done;Sb=gR.next())Co=Sb.value,SF={playlistId:h},yh={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:SF},Ra.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Co,"mainVideoEntity",0,xb,yh));return uW.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,Ra))}})},AiK=function(D,X){var M,Q,h,H;
return g.r(function(t){switch(t.S){case 1:return M=qA(X),g.N_(t,2),Q=g.il(X.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.I(t,dbn(D.S,X,D.Y,(h=X.actionMetadata)==null?void 0:(H=h.offlineLoggingData)==null?void 0:H.offlineDeleteReason),5):g.I(t,gqZ(Q,D.S,X,D.Y),6);case 6:if(!D.j.T("woffle_enable_main_downloads_library")){t.D4(5);break}return g.I(t,A2K(D.S,X.entityKey),5);case 5:g.Ty(t,3);break;case 2:return g.LG(t),t.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M))}})},isZ=function(D,X,M,Q){var h,H,t,q,w,T,L;
return g.r(function(K){switch(K.S){case 1:return g.I(K,DNt([X]),2);case 2:return h=K.G,g.I(K,Yy_(D,h[0],M,Q),3);case 3:return H=K.G,t=H.mainPlaylistEntity,q=H.YW5,T=Rib(t,(w=q)==null?void 0:w.avatar),g.N_(K,4),g.I(K,UA(T),6);case 6:g.Ty(K,5);break;case 4:L=g.LG(K),L instanceof Error&&L.message==="Failed to fetch"&&MA(L.message);case 5:return K.return(h[0].videos)}})},Yy_=function(D,X,M,Q){var h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v;
return g.r(function(l){switch(l.S){case 1:h=Date.now().toString();M||(M=h);H=X.videos;t=X.playlistId;q=[];w=[];if(H)for(T=g.e(H),L=T.next();!L.done;L=T.next()){K=L.value;a=K.offlineVideoData;if(!a||!a.videoId)throw MA("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");F=a.videoId;V={videoId:F,playlistId:t};c={id:g.oL(JSON.stringify(V),"mainPlaylistVideoEntity"),video:g.oL(F,"mainVideoEntity")};q.push(c);w.push(c.id)}b={key:g.oL(t,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:M,lastSyncedTimestampMillis:h};n={key:g.oL(t,"mainPlaylistEntity"),playlistId:t,videos:w,title:X.title,thumbnailStyleData:lut(X),visibility:JiZ(X),downloadState:b.key};X.channel&&(R=X.channel.offlineChannelData,S=xmB(g.oL(t,"ytMainChannelEntity"),R),n.channelOwner=S.id);((v=n)==null?0:v.entityMetadata)?(n.entityMetadata.offlineLastModifiedTimestampSeconds=X.lastModifiedTimestamp,Q&&(n.entityMetadata.nextAutoRefreshIntervalSeconds=String(Q))):n&&(n.entityMetadata={nextAutoRefreshIntervalSeconds:Q?
String(Q):void 0,offlineLastModifiedTimestampSeconds:X.lastModifiedTimestamp});g.N_(l,2);return g.I(l,WV(D.S,{mode:"readwrite",d3:!0},function(A){var Hs=Yh(A,n,"mainPlaylistEntity"),u=Yh(A,b,"mainPlaylistDownloadStateEntity");Hs=[Hs,u];u=g.e(q);for(var D_=u.next();!D_.done;D_=u.next())Hs.push(Yh(A,D_.value,"mainPlaylistVideoEntity"));S&&Hs.push(Yh(A,S,"ytMainChannelEntity"));return g.Bc.all(Hs)}),4);
case 4:g.Ty(l,3);break;case 2:throw g.LG(l),MA("PES failure for playlist"),Error("PES failure for playlist");case 3:return l.return({mainPlaylistEntity:n,YW5:S,yV$:q})}})},xmB=function(D,X){return{id:D,
channelId:X.channelId,title:X.title,avatar:X.thumbnail}},lut=function(D){var X=[],M=D.videos;
M&&M.length>0&&X.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:M[0].offlineVideoData.thumbnail}}});if((D=D.additionalMetadadatas)&&D.length>0)for(D=g.e(D),M=D.next();!M.done;M=D.next()){var Q=M.value.offlineBundleItemPlaylistData,h=void 0;M=(h=Q)==null?void 0:h.style;h=void 0;Q={collageThumbnail:{coverThumbnail:(h=Q)==null?void 0:h.coverThumbnail}};switch(M){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":X.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:Q});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":X.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:Q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":X.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:Q});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":X.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:Q})}}return X},JiZ=function(D){switch(D.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},o1h=function(D,X,M){X={offlineVideoData:X,
playlistId:M};if(D=g.Z(D.actionMetadata,Osh))X.maximumDownloadQuality=D.maximumDownloadQuality;return{mainVideoEntityActionMetadata:X}},W$h=function(D,X,M){this.S=D;
this.j=X;this.Y=M},kWt=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V;
return g.r(function(c){switch(c.S){case 1:return M=qA(X),Q=g.il(X.entityKey),h=Q.entityId,H=g.Z(X.actionMetadata,W6),q=!((t=H)==null?0:t.playlistId),g.N_(c,2),g.I(c,GWy(D,h,void 0,(w=H)==null?void 0:w.offlineVideoData,q),4);case 4:g.Ty(c,3);break;case 2:return T=g.LG(c),L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.Li&&T.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
c.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,L,K));case 3:a=1;a=Number(((F=X.actionMetadata)==null?void 0:F.priority)||0)+1;var S=(S=g.Z(X.actionMetadata,W6))?{playbackDataActionMetadata:{maximumDownloadQuality:S.maximumDownloadQuality}}:void 0;V=RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h,"playbackData",a,zJy,S);return c.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,[V]))}})},u2Z=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n;
return g.r(function(R){switch(R.S){case 1:return M=qA(X),Q=g.il(X.entityKey),h=Q.entityId,g.I(R,zs(D.S,X.entityKey,"mainVideoEntity"),2);case 2:H=R.G;if(!H){t=void 0;R.D4(3);break}return g.I(R,zs(D.S,H.downloadState,"mainVideoDownloadStateEntity"),4);case 4:t=R.G;case 3:q=t;if(!H||!q)return R.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));g.N_(R,5);return g.I(R,GWy(D,h,q.addedTimestampMillis,(T=g.Z(X.actionMetadata,W6))==null?void 0:T.offlineVideoData),7);case 7:L=1;L=Number(((K=
X.actionMetadata)==null?void 0:K.priority)||0)+1;w=RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",h,"playbackData",L,zJy);g.Ty(R,6);break;case 5:a=g.LG(R);if(!(a instanceof Error&&a.message==="No data")){if(a instanceof Error&&a.message==="Empty response body")MA(a.message);else return F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.Li&&a.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),R.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,F,V));R.D4(6);break}return g.I(R,Sc(D.S,h),9);case 9:c=R.G;S=g.Z(X.actionMetadata,W6);if(n=(b=S)==null?void 0:b.playlistId)c.playlistId=n;c.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.I(R,c6(h,D.S,X,D.Y,c),6);case 6:return R.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,w?[w]:void 0))}})},j7h=function(D,X){var M,Q,h,H,t,q,w,T,L,K;
return g.r(function(a){switch(a.S){case 1:return M=qA(X),g.N_(a,2),Q=g.il(X.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.I(a,dbn(D.S,X,D.Y,(L=X.actionMetadata)==null?void 0:(K=L.offlineLoggingData)==null?void 0:K.offlineDeleteReason),5):g.I(a,Sc(D.S,Q),6);case 6:h=a.G;H=g.Z(X.actionMetadata,W6);if(q=(t=H)==null?void 0:t.playlistId)h.playlistId=q;h.offlineDeleteReason=(w=X.actionMetadata)==null?void 0:(T=w.offlineLoggingData)==null?void 0:T.offlineDeleteReason;return g.I(a,c6(Q,D.S,X,D.Y,h),7);
case 7:if(!D.j.T("woffle_enable_main_downloads_library")){a.D4(5);break}return g.I(a,A2K(D.S,X.entityKey),5);case 5:g.Ty(a,3);break;case 2:return g.LG(a),a.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return a.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M))}})},GWy=function(D,X,M,Q,h){var H,t,q,w,T,L;
return g.r(function(K){switch(K.S){case 1:if(H=Q){K.D4(2);break}return g.I(K,jch([X]),3);case 3:t=K.G,H=t[0];case 2:return g.I(K,D6W(D,H,M,h),4);case 4:q=K.G;w=q.mainVideoEntity;T=q.channelEntity;g.N_(K,5);var a=FK(w.thumbnail),F=FK(T.avatar);return g.I(K,UA(a.concat(F)),7);case 7:g.Ty(K,0);break;case 5:L=g.LG(K),L instanceof Error&&L.message==="Failed to fetch"&&MA(L.message),g.HZ(K)}})},D6W=function(D,X,M,Q){var h,H,t,q,w,T,L,K,a,F,V,c,S;
return g.r(function(b){switch(b.S){case 1:M||(M=Date.now().toString());H=(h=X.channel)==null?void 0:h.offlineChannelData;t={id:g.oL(X.videoId,"ytMainChannelEntity"),channelId:H.channelId,title:H.title,avatar:H.thumbnail};q={key:g.oL(X.videoId,"mainVideoDownloadStateEntity"),playbackData:g.oL(X.videoId,"playbackData"),addedTimestampMillis:M,videoDownloadContextEntity:g.oL(X.videoId,"videoDownloadContextEntity")};w={key:g.oL(X.videoId,"videoPlaybackPositionEntity"),videoId:X.videoId,lastPlaybackPositionSeconds:"0"};
D.j.T("html5_offline_playback_position_sync")&&(T={playbackPosition:w.key});L=g.oL(X.videoId,"mainVideoEntity");K={key:L,videoId:X.videoId,title:X.title,thumbnail:X.thumbnail,localizedStrings:{viewCount:X.shortViewCountText},userState:T,lengthSeconds:X.lengthSeconds?Number(X.lengthSeconds):void 0,publishedTimestampMillis:X.publishedTimestamp?(Number(X.publishedTimestamp)*1E3).toString():void 0,formattedDescription:X.description,owner:t.id,downloadState:q.key};if(!D.j.T("woffle_enable_main_downloads_library")||
!Q){b.D4(2);break}return g.I(b,OPB(D.S,[L]),3);case 3:if(V=b.G)a=V.mainDownloadsLibraryEntity,F=V.mainDownloadsListEntity;case 2:return S=y2y,c={key:g.oL(X.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.RO(q,S,c),g.I(b,WV(D.S,{mode:"readwrite",d3:!0},function(n){var R=Yh(n,t,"ytMainChannelEntity"),v=Yh(n,q,"mainVideoDownloadStateEntity"),l=Yh(n,K,"mainVideoEntity");R=[R,v,l];D.j.T("html5_offline_playback_position_sync")&&(v=Yh(n,w,"videoPlaybackPositionEntity"),
R.push(v));a&&(v=Yh(n,a,"mainDownloadsLibraryEntity"),R.push(v));F&&(v=Yh(n,F,"mainDownloadsListEntity"),R.push(v));c&&(n=Yh(n,c,"downloadStatusEntity"),R.push(n));return g.Bc.all(R)}),4);
case 4:return b.return({mainVideoEntity:K,channelEntity:t})}})},XgC=function(D,X,M){this.S=D;
this.j=X;this.Y=M},Q_t=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs;
return g.r(function(S2){switch(S2.S){case 1:return M=qA(X),Q=[],g.I(S2,iV.getInstance(),2);case 2:h=S2.G;if(!h){S2.D4(3);break}return g.I(S2,h.get("sdois"),4);case 4:return H=S2.G,g.I(S2,(q=h)==null?void 0:q.get("lmqf"),5);case 5:t=S2.G;case 3:g.N_(S2,6);if(H===void 0)throw Error("prefStorage or opt-in state is undefined");w=[];if(H){S2.D4(8);break}return g.I(S2,C0W(D.S),9);case 9:w=S2.G,w.reverse();case 8:if(!w.length){S2.D4(10);break}T=g.e(w);L=T.next();case 11:if(L.done){S2.D4(10);break}K=L.value;
if(!K){S2.D4(12);break}a=g.il(K).entityId;return g.I(S2,Sc(D.S,a),14);case 14:return F=S2.G,F.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.I(S2,c6(a,D.S,{entityKey:K,actionType:X.actionType},D.Y,F),12);case 12:L=T.next();S2.D4(11);break;case 10:return g.I(S2,h2n(H,(V=t)!=null?V:"SD"),16);case 16:return c=S2.G,g.I(S2,r2W(c),17);case 17:S=oqt(c);if(!D.j.T("woffle_enable_main_downloads_library")){S2.D4(18);break}if(H){S2.D4(19);break}return g.I(S2,A2K(D.S,g.Ir),19);case 19:return g.I(S2,
pSn(D.S,[g.Ir]),18);case 18:if((b=S)==null?0:b.length)for(n=g.e(S),R=n.next();!R.done;R=n.next())if(l=v=R.value,A=l.actionType,Hs=l.entityKey,u=l.actionMetadata,A&&Hs&&u&&!g.Z(u,MRG)){A==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(u.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(D_=g.Z(v.actionMetadata,W6))D_.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",v.actionMetadata=Object.assign({},v.actionMetadata,{mainVideoEntityActionMetadata:D_});Q.push(v)}g.Ty(S2,
7);break;case 6:return q5=g.LG(S2),Lo="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Qs="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q5 instanceof g.Li&&q5.type==="QUOTA_EXCEEDED"&&(Lo="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Qs="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S2.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,Lo,Qs));case 7:return S2.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,Q))}})},hpn=function(){lo.apply(this,
arguments);
this.eH="mainVideoEntity"},HYW=function(D,X,M){X=X===void 0?43200:X;
M=M===void 0?!0:M;var Q=Q===void 0?!1:Q;var h,H,t;return g.r(function(q){switch(q.S){case 1:if(!D.X.Yh())return q.return([]);h=[];g.N_(q,2);return g.I(q,MwC(X,M,Q),4);case 4:h=q.G;g.Ty(q,3);break;case 2:H=g.LG(q),H instanceof Error&&H.message==="No data"||H instanceof Error&&H.message==="Empty response body"&&MA(H.message);case 3:return t=v1n(D,h,M,"mainPlaylistEntity"),q.return(t)}})},tRy=function(D,X,M,Q){Q=Q===void 0?!1:Q;
var h,H,t,q,w,T,L,K,a,F,V,c,S,b,n;return g.r(function(R){switch(R.S){case 1:return h=[],g.I(R,Q3t(),2);case 2:return(H=R.G)||Q?g.I(R,Hmn(X,M),3):R.return([]);case 3:t=R.G;if((q=t)==null||!q.length)return R.return([]);w={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};T=g.e(t);L=T.next();case 4:if(L.done){R.D4(6);break}a=K=L.value;F=a.actionType;V=a.entityKey;c=a.actionMetadata;if(!(F&&V&&c)||g.Z(c,MRG)){R.D4(5);break}F==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(c.offlineLoggingData=
w);S=g.il(V);b=S.entityId;return g.I(R,JZ(D,[b],"mainVideoEntity",F,c),8);case 8:n=R.G,h=h.concat(n);case 5:L=T.next();R.D4(4);break;case 6:return R.return(h)}})},Nht=function(D,X){this.S=D;
this.Y=X},wgr=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b;
return g.r(function(n){switch(n.S){case 1:return M=qA(X),Q=g.il(X.entityKey),h=Q.entityId,H=[],g.N_(n,2),g.I(n,qhn(D,h),4);case 4:H=n.G;if((t=H)==null||!t.length){n.D4(5);break}return g.I(n,Wdh(D.S,X.entityKey),5);case 5:g.Ty(n,3);break;case 2:return q=g.LG(n),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.Li&&q.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
n.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,w,T));case 3:return L=[],g.I(n,P0G(D.S,"musicTrack",H),7);case 7:H=n.G;if(H.length)for(K=g.e(H),a=K.next();!a.done;a=K.next())if(F=a.value,V=F.offlineVideoData,c=void 0,(c=V)==null?0:c.videoId)S=void 0,b=Number(((S=X.actionMetadata)==null?void 0:S.priority)||0)+1,L.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V.videoId,"musicTrack",b,Gu,mP(X,V,h)));return n.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,L))}})},
Thh=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs,S2,XC,q_,th,Jd,Gp,zy,Ra,m,$B,WZ,wR,eb,E,Xn,ci,qu,Wi,wS,zp,Dt,Pi,P,f,y,d,W,N5,z,J,C,Ri;
return g.r(function(Ii){switch(Ii.S){case 1:return M=qA(X),Q=X.entityKey,h=g.il(Q).entityId,H=[],t=!1,h==="!*$_ALL_ENTITIES_!*$"?(t=!0,g.I(Ii,kh(D.S,"musicAlbumRelease"),5)):g.I(Ii,zs(D.S,Q,"musicAlbumRelease"),4);case 4:(q=Ii.G)&&H.push(q);Ii.D4(3);break;case 5:H=Ii.G;case 3:if((w=H)==null||!w.length)return Ii.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));if(t){T=[];L=g.e(H);for(K=L.next();!K.done;K=L.next())a=K.value,F=g.il(a.id).entityId,T.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
F,"musicAlbumRelease",0,Gu));return Ii.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,T))}V=[];c=H[0];S=void 0;if(!c.downloadMetadata){Ii.D4(6);break}return g.I(Ii,zs(D.S,c.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:b=Ii.G,S=Number((R=(n=b)==null?void 0:n.addedTimestampMillis)!=null?R:"0")/1E3;case 6:return g.N_(Ii,8),g.I(Ii,qhn(D,h,(v=S)==null?void 0:v.toString()),10);case 10:V=Ii.G;g.Ty(Ii,9);break;case 8:l=g.LG(Ii);if(!(l instanceof Error&&l.message===
"No data")){if(l instanceof Error&&l.message==="Empty response body")MA(l.message);else return A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Hs="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.Li&&l.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Hs="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ii.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,A,Hs));Ii.D4(9);break}return g.I(Ii,yT(h,"musicAlbumRelease",
D.S,X,D.Y),9);case 9:u=[];D_=new Map;if((q5=V)==null?0:q5.length)for(Lo=g.e(V),Qs=Lo.next();!Qs.done;Qs=Lo.next())S2=Qs.value,XC=S2.offlineVideoData,q_=void 0,((q_=XC)==null?0:q_.videoId)&&D_.set(XC.videoId,XC);th=new Map;Jd=[];if((Gp=c)==null?0:(zy=Gp.tracks)==null?0:zy.length)for(Ra=g.e(c.tracks),m=Ra.next();!m.done;m=Ra.next())if($B=m.value,WZ=g.il($B).entityId)D_.has(WZ)?(th.set(WZ,D_.get(WZ)),D_.delete(WZ)):Jd.push(WZ);eb=Number(((wR=X.actionMetadata)==null?void 0:wR.priority)||0)+1;E=g.e(D_.entries());
for(Xn=E.next();!Xn.done;Xn=E.next())ci=Xn.value,qu=g.e(ci),Wi=qu.next().value,wS=qu.next().value,zp=Wi,Dt=wS,u.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",zp,"musicTrack",eb,Gu,mP(X,Dt)));Pi=g.e(th.entries());for(P=Pi.next();!P.done;P=Pi.next())f=P.value,y=g.e(f),d=y.next().value,W=y.next().value,N5=d,z=W,u.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N5,"musicTrack",eb,Gu,mP(X,z)));J=g.e(Jd);for(C=J.next();!C.done;C=J.next())Ri=C.value,u.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Ri,"musicTrack",0,Gu));return Ii.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,u))}})},L__=function(D,X){var M,Q;
return g.r(function(h){switch(h.S){case 1:return M=qA(X),g.N_(h,2),Q=g.il(X.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.I(h,P6(D.S,X,D.Y),5):g.I(h,yT(Q,"musicAlbumRelease",D.S,X,D.Y),6);case 6:return g.I(h,GeB(D.S,X.entityKey),5);case 5:g.Ty(h,3);break;case 2:return g.LG(h),h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},qhn=function(D,X,M){var Q,h,H;
return g.r(function(t){switch(t.S){case 1:return g.I(t,DNt([X]),2);case 2:return Q=t.G,g.I(t,s_B(D,Q[0],M),3);case 3:return h=t.G,H=FK(h.thumbnailDetails),g.I(t,UA(H),4);case 4:return t.return(Q[0].videos)}})},s_B=function(D,X,M){var Q,h,H,t,q,w,T,L,K,a,F,V,c,S;
return g.r(function(b){if(b.S==1){Q=X.additionalMetadadatas;h=void 0;if(Q&&Q.length>0)for(H=g.e(Q),t=H.next();!t.done;t=H.next())if(q=t.value,q.offlineMusicPlaylistData){h=q.offlineMusicPlaylistData;break}w=X.playlistId;T=zia(X);L=T.TG;K=T.M0;a=M?(Number(M)*1E3).toString():Date.now().toString();F=X.lastModifiedTimestamp?(Number(X.lastModifiedTimestamp)*1E3).toString():"0";V={id:g.oL(w,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:K,lastModifiedTimestampMillis:F,addedTimestampMillis:a,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};c={id:g.oL(w,"musicAlbumRelease"),title:X.title,audioPlaylistId:w,trackCount:X.totalVideoCount,tracks:L,downloadMetadata:V.id};h&&(c.thumbnailDetails=(S=h.albumHqThumbnail)!=null?S:h.albumArtistThumbnail,c.artistDisplayName=h.albumArtistDisplayName,c.releaseDate=h.albumReleaseDate,c.contentRating={explicitType:h.albumReleaseExplicitType},c.releaseType=h.albumReleaseType);return g.I(b,WV(D.S,{mode:"readwrite",d3:!0},function(n){var R=Yh(n,c,"musicAlbumRelease");
n=Yh(n,V,"musicAlbumReleaseDownloadMetadataEntity");return g.Bc.all([R,n])}),2)}return b.return(c)})},K_B=function(D,X){this.S=D;
this.Y=X},F_b=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b;
return g.r(function(n){switch(n.S){case 1:return M=qA(X),Q=g.il(X.entityKey),h=Q.entityId,H=[],g.N_(n,2),g.I(n,awn(D,h),4);case 4:H=n.G;if((t=H)==null||!t.length){n.D4(5);break}return g.I(n,Wdh(D.S,X.entityKey),5);case 5:g.Ty(n,3);break;case 2:return q=g.LG(n),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.Li&&q.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
n.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,w,T));case 3:return L=[],g.I(n,P0G(D.S,"musicTrack",H),7);case 7:H=n.G;if(H.length)for(K=g.e(H),a=K.next();!a.done;a=K.next())if(F=a.value,V=F.offlineVideoData,c=void 0,(c=V)==null?0:c.videoId)S=void 0,b=Number(((S=X.actionMetadata)==null?void 0:S.priority)||0)+1,L.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V.videoId,"musicTrack",b,zu,mP(X,V,h)));return n.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,L))}})},
VRh=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs,S2,XC,q_,th,Jd,Gp,zy,Ra,m,$B,WZ,wR,eb,E,Xn,ci,qu,Wi,wS,zp,Dt,Pi,P,f,y,d,W,N5,z,J,C,Ri,Ii,Z_,b1,Qh,mH,pf,vi,kB,e2,CR,gR,Sb;
return g.r(function(Co){switch(Co.S){case 1:return M=qA(X),Q=X.entityKey,h=g.il(Q).entityId,H=[],t=!1,h==="!*$_ALL_ENTITIES_!*$"?(t=!0,g.I(Co,kh(D.S,"musicPlaylist"),5)):g.I(Co,zs(D.S,Q,"musicPlaylist"),4);case 4:(q=Co.G)&&H.push(q);Co.D4(3);break;case 5:H=Co.G;case 3:if((w=H)==null||!w.length)return Co.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));T=g.Z(X.actionMetadata,keW);K=(L=T)==null?void 0:L.autoSync;a=[];V=F=!0;c=!1;S=void 0;if(!t&&K===!1){Co.D4(6);break}g.N_(Co,7);return g.I(Co,
twr(0,!!K,!0,H),9);case 9:a=Co.G;g.Ty(Co,8);break;case 7:b=g.LG(Co);if(!(b instanceof Error&&b.message==="No data")){b instanceof Error&&b.message==="Empty response body"&&MA(b.message);Co.D4(8);break}return h==="!*$_ALL_ENTITIES_!*$"?g.I(Co,P6(D.S,X,D.Y),8):g.I(Co,yT(h,"musicPlaylist",D.S,X,D.Y),8);case 8:if(!a.length||!t&&a[0].playlistId!==h)return Co.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));case 6:if(t){n=[];R=g.e(a);for(v=R.next();!v.done;v=R.next())l=v.value,l.upToDate||
K&&!l.shouldAutoSyncMetadata||!l.playlistId||(A={autoSync:K},n.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",l.playlistId,"musicPlaylist",0,zu,{musicPlaylistEntityActionMetadata:A})));return Co.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,n))}a.length&&(Hs=a[0],c=!!Hs.upToDate,K&&(F=(u=Hs.shouldAutoSyncMetadata)!=null?u:!0,V=(D_=Hs.shouldAutoSyncVideos)!=null?D_:!0,Hs.checkInSeconds&&(S=Hs.checkInSeconds)));if(c||!F)return Co.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M));q5=[];Lo=H[0];Qs=void 0;if(!Lo.downloadMetadata){Co.D4(15);break}return g.I(Co,zs(D.S,Lo.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:S2=Co.G,Qs=Number((q_=(XC=S2)==null?void 0:XC.addedTimestampMillis)!=null?q_:"0")/1E3;case 15:return g.N_(Co,17),g.I(Co,awn(D,h,(th=Qs)==null?void 0:th.toString(),S),19);case 19:q5=Co.G;g.Ty(Co,18);break;case 17:Jd=g.LG(Co);if(!(Jd instanceof Error&&Jd.message==="No data")){if(Jd instanceof Error&&Jd.message==="Empty response body")MA(Jd.message);
else return Gp="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",zy="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Jd instanceof g.Li&&Jd.type==="QUOTA_EXCEEDED"&&(Gp="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",zy="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Co.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,Gp,zy));Co.D4(18);break}return g.I(Co,yT(h,"musicPlaylist",D.S,X,D.Y),18);case 18:if(!V)return Co.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M));Ra=[];m=new Map;if(($B=q5)==null?0:$B.length)for(WZ=g.e(q5),wR=WZ.next();!wR.done;wR=WZ.next())eb=wR.value,E=eb.offlineVideoData,Xn=void 0,((Xn=E)==null?0:Xn.videoId)&&m.set(E.videoId,E);ci=new Map;qu=[];if((Wi=Lo)==null?0:(wS=Wi.tracks)==null?0:wS.length)for(zp=g.e(Lo.tracks),Dt=zp.next();!Dt.done;Dt=zp.next())if(Pi=Dt.value,P=g.il(Pi).entityId)m.has(P)?(ci.set(P,m.get(P)),m.delete(P)):qu.push(P);y=Number(((f=X.actionMetadata)==null?void 0:f.priority)||0)+1;d=g.e(m.entries());for(W=d.next();!W.done;W=
d.next())N5=W.value,z=g.e(N5),J=z.next().value,C=z.next().value,Ri=J,Ii=C,Ra.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Ri,"musicTrack",y,zu,mP(X,Ii)));Z_=g.e(ci.entries());for(b1=Z_.next();!b1.done;b1=Z_.next())Qh=b1.value,mH=g.e(Qh),pf=mH.next().value,vi=mH.next().value,kB=pf,e2=vi,Ra.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",kB,"musicTrack",y,zu,mP(X,e2)));CR=g.e(qu);for(gR=CR.next();!gR.done;gR=CR.next())Sb=gR.value,Ra.push(RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Sb,"musicTrack",
0,zu));return Co.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,Ra))}})},$6C=function(D,X){var M,Q;
return g.r(function(h){switch(h.S){case 1:return M=qA(X),g.N_(h,2),Q=g.il(X.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.I(h,P6(D.S,X,D.Y),5):g.I(h,yT(Q,"musicPlaylist",D.S,X,D.Y),6);case 6:return g.I(h,GeB(D.S,X.entityKey),5);case 5:g.Ty(h,3);break;case 2:return g.LG(h),h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},awn=function(D,X,M,Q){var h,H,t;
return g.r(function(q){switch(q.S){case 1:return g.I(q,DNt([X]),2);case 2:return h=q.G,g.I(q,BhC(D,h[0],M,Q),3);case 3:return H=q.G,t=FK(H.thumbnailDetails),g.I(q,UA(t),4);case 4:return q.return(h[0].videos)}})},BhC=function(D,X,M,Q){var h,H,t,q,w,T,L,K,a;
return g.r(function(F){return F.S==1?(h=X.playlistId,H=zia(X),t=H.TG,q=H.M0,w=M?(Number(M)*1E3).toString():Date.now().toString(),T=X.lastModifiedTimestamp?(Number(X.lastModifiedTimestamp)*1E3).toString():"0",L={id:g.oL(h,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:q,lastModifiedTimestampMillis:T,addedTimestampMillis:w,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},K={id:g.oL(h,"musicPlaylist"),title:X.title,playlistId:h,thumbnailDetails:X.thumbnail,visibility:ZYa(X),trackCount:X.totalVideoCount,
tracks:t,downloadMetadata:L.id},Q&&(((a=K)==null?0:a.entityMetadata)?K.entityMetadata.nextAutoRefreshIntervalSeconds=String(Q):K&&(K.entityMetadata={nextAutoRefreshIntervalSeconds:String(Q)})),g.I(F,WV(D.S,{mode:"readwrite",d3:!0},function(V){var c=Yh(V,K,"musicPlaylist");V=Yh(V,L,"musicPlaylistDownloadMetadataEntity");return g.Bc.all([c,V])}),2)):F.return(K)})},ZYa=function(D){switch(D.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},U6a=function(D,X){this.S=D;
this.Y=X},Epr=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V;
return g.r(function(c){switch(c.S){case 1:return M=qA(X),Q=g.il(X.entityKey),h=Q.entityId,H=g.Z(X.actionMetadata,cpG),g.N_(c,2),g.I(c,fwh(D,h,void 0,(t=H)==null?void 0:t.track,(q=H)==null?void 0:q.albumRelease),4);case 4:if((w=H)==null?0:w.playlistId){c.D4(5);break}return g.I(c,Wdh(D.S,X.entityKey),5);case 5:g.Ty(c,3);break;case 2:return T=g.LG(c),L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.Li&&T.type==="QUOTA_EXCEEDED"&&
(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),c.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,L,K));case 3:F=Number(((a=X.actionMetadata)==null?void 0:a.priority)||0)+1;var S=(S=g.Z(X.actionMetadata,cpG))?{playbackDataActionMetadata:{maximumDownloadQuality:S.maximumDownloadQuality}}:void 0;V=RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h,"playbackData",F,Shb,S);return c.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M,[V]))}})},ypy=function(D,X){var M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S;
return g.r(function(b){switch(b.S){case 1:return M=qA(X),Q=g.il(X.entityKey),h=Q.entityId,g.I(b,zs(D.S,X.entityKey,"musicTrack"),2);case 2:H=b.G;if(!H){t=void 0;b.D4(3);break}return g.I(b,zs(D.S,H.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:t=b.G;case 3:q=t;if(!H||!q)return b.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));T=g.Z(X.actionMetadata,cpG);g.N_(b,5);return g.I(b,fwh(D,h,q.addedTimestampMillis,(L=T)==null?void 0:L.track,(K=T)==null?void 0:K.albumRelease),
7);case 7:F=Number(((a=X.actionMetadata)==null?void 0:a.priority)||0)+1;w=RR("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",h,"playbackData",F,Shb);g.Ty(b,6);break;case 5:V=g.LG(b);if(!(V instanceof Error&&V.message==="No data")){if(V instanceof Error&&V.message==="Empty response body")MA(V.message);else return c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.Li&&V.type==="QUOTA_EXCEEDED"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),b.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,c,S));b.D4(6);break}return g.I(b,EA(h,D.S,X,D.Y),6);case 6:return b.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,w?[w]:void 0))}})},Prh=function(D,X){var M,Q;
return g.r(function(h){switch(h.S){case 1:return M=qA(X),g.N_(h,2),Q=g.il(X.entityKey).entityId,Q==="!*$_ALL_ENTITIES_!*$"?g.I(h,P6(D.S,X,D.Y),5):g.I(h,EA(Q,D.S,X,D.Y),6);case 6:return g.I(h,GeB(D.S,X.entityKey),5);case 5:g.Ty(h,3);break;case 2:return g.LG(h),h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return h.return(new IR("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},fwh=function(D,X,M,Q,h){var H,t,q,w,T,L;
return g.r(function(K){switch(K.S){case 1:if(H=Q){K.D4(2);break}return g.I(K,jch([X]),3);case 3:t=K.G,q=t[0],H=xbh(q);case 2:return g.I(K,m68(D,H,X,h,M),4);case 4:w=K.G;T=w.musicTrackEntity;L=w.uK;var a=FK(T.thumbnailDetails),F=[];L&&(F=FK(L.thumbnailDetails));return g.I(K,UA(a.concat(F)),0)}})},m68=function(D,X,M,Q,h){var H;
return g.r(function(t){return t.S==1?(h||(h=Date.now().toString()),H={id:g.oL(M,"musicTrackDownloadMetadataEntity"),playbackData:g.oL(M,"playbackData"),addedTimestampMillis:h,videoDownloadContextEntity:g.oL(M,"videoDownloadContextEntity")},Q&&(X.albumRelease=Q.id),g.I(t,WV(D.S,{mode:"readwrite",d3:!0},function(q){var w=[],T=Yh(q,H,"musicTrackDownloadMetadataEntity");w.push(T);T=Yh(q,X,"musicTrack");w.push(T);Q&&(q=Yh(q,Q,"musicAlbumRelease"),w.push(q));return g.Bc.all(w)}),2)):t.S!=3?g.I(t,sA(M,"musicTrackDownloadMetadataEntity",
D.S,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):t.return({musicTrackEntity:X,
uK:Q})})},kb=function(){lo.apply(this,arguments);
this.eH="musicTrack"},npB=function(D,X,M){X=X===void 0?43200:X;
M=M===void 0?!0:M;var Q=Q===void 0?!1:Q;var h,H;return g.r(function(t){switch(t.S){case 1:if(!D.X.Yh())return t.return([]);h=[];g.N_(t,2);return g.I(t,twr(X,M,Q),4);case 4:h=t.G;g.Ty(t,3);break;case 2:g.LG(t);case 3:return H=v1n(D,h,M,"musicPlaylist"),t.return(H)}})},bYK=function(){g.Tn.apply(this,arguments);
var D=this;this.events=new g.HE(this);this.j=this.player.W();this.py={Y$5:function(){return D.S},
yl:function(){return D.yl()},
Y3:function(X){return D.Y3(X)}}},epZ=function(D){var X;
D=g.Z((X=D.getWatchNextResponse())==null?void 0:X.currentVideoEndpoint,g.QM);if(D==null?0:D.playlistId)var M=D.playlistId;return M},Rpb=function(D,X){var M,Q,h,H;
return g.r(function(t){if(t.S==1){M=X.clientPlaybackNonce;Q={cpn:M,offlineSourceVisualElement:g.sT(X.f$||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};X.G&&(Q.videoFmt=Number(X.G.itag));X.U&&(Q.audioFmt=Number(X.U.itag));if((h=epZ(X))&&X.videoId){var q=X.videoId;q=h!=="PPSV"?Promise.resolve(!1):D.S.Eb(q);t=g.I(t,q,3)}else t=t.D4(2);return t}t.S!=2&&(H=t.G)&&(Q.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");D.G=M;g.Tm("offlinePlaybackStarted",Q);g.HZ(t)})};
g.mU.prototype.fU=g.i1(41,function(D){return this.app.fU(D)});
g.TI.prototype.fU=g.i1(40,function(D){return g.b39(this,9,D)});
g.U(dG,vV);g.Ad.Object.defineProperties(dG.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.S.entityMetadata},
set:function(D){this.S.entityMetadata=D}}});
g.U(BQ8,dG);BQ8.prototype.G=function(){return[]};
g.U(Z1h,dG);Z1h.prototype.G=function(){return[]};
g.U(Uhh,dG);Uhh.prototype.G=function(){return[]};
g.U(cKr,dG);cKr.prototype.G=function(){return[]};
g.U(fXB,dG);fXB.prototype.G=function(){return[]};
g.U(SUa,dG);SUa.prototype.G=function(){var D=[];this.S.alternateChannel&&D.push(this.S.alternateChannel);this.S.alternateChannelList&&D.push.apply(D,g.xW(this.S.alternateChannelList));this.S.oneofChannelEntity&&D.push(this.S.oneofChannelEntity);return[].concat(g.xW(new Set(D)))};
g.U(EXC,dG);EXC.prototype.G=function(){var D=[];this.S.entryCollection&&D.push(this.S.entryCollection);return[].concat(g.xW(new Set(D)))};
g.U(yKa,vV);yKa.prototype.G=function(){var D=[];this.S.video&&D.push(this.S.video);return[].concat(g.xW(new Set(D)))};
g.U(PgW,dG);PgW.prototype.G=function(){var D=[];this.S.parentPlaylist&&D.push(this.S.parentPlaylist);if(this.S.entries)for(var X=g.e(this.S.entries),M=X.next();!M.done;M=X.next())D.push.apply(D,g.xW((new yKa(M.value)).G()));return[].concat(g.xW(new Set(D)))};
g.U(mh8,dG);mh8.prototype.G=function(){var D=[];this.S.descriptionEntity&&D.push(this.S.descriptionEntity);this.S.creators&&D.push.apply(D,g.xW(this.S.creators));this.S.theBiggestFan&&D.push(this.S.theBiggestFan);return[].concat(g.xW(new Set(D)))};
g.U(nXa,dG);nXa.prototype.G=function(){return[]};
g.U(b1y,dG);b1y.prototype.G=function(){return[]};
g.U(e88,dG);e88.prototype.G=function(){return[]};
g.U(R8a,dG);R8a.prototype.G=function(){return[]};
g.U(IXt,dG);IXt.prototype.G=function(){return[]};
g.U(gXb,dG);gXb.prototype.G=function(){return[]};
g.U(vXh,dG);vXh.prototype.G=function(){return[]};
g.U(dhZ,dG);dhZ.prototype.G=function(){return[]};
g.U(rKK,dG);rKK.prototype.G=function(){return[]};
g.U(i1h,dG);i1h.prototype.G=function(){var D=[];this.S.downloadsList&&D.push(this.S.downloadsList);this.S.smartDownloadsList&&D.push(this.S.smartDownloadsList);this.S.recommendedDownloadsList&&D.push(this.S.recommendedDownloadsList);this.S.refresh&&D.push(this.S.refresh);return[].concat(g.xW(new Set(D)))};
g.U(oXC,vV);oXC.prototype.G=function(){var D=[];this.S.video&&D.push(this.S.video);this.S.playlist&&D.push(this.S.playlist);this.S.videoItem&&D.push(this.S.videoItem);this.S.playlistItem&&D.push(this.S.playlistItem);return[].concat(g.xW(new Set(D)))};
g.U(CgG,dG);CgG.prototype.G=function(){var D=[];this.S.refresh&&D.push(this.S.refresh);if(this.S.downloads)for(var X=g.e(this.S.downloads),M=X.next();!M.done;M=X.next())D.push.apply(D,g.xW((new oXC(M.value)).G()));return[].concat(g.xW(new Set(D)))};
g.U(O1h,dG);O1h.prototype.G=function(){var D=[];this.S.localImageEntities&&D.push.apply(D,g.xW(this.S.localImageEntities));return[].concat(g.xW(new Set(D)))};
g.U(phG,dG);phG.prototype.G=function(){var D=[];this.S.playbackData&&D.push(this.S.playbackData);this.S.localImageEntities&&D.push.apply(D,g.xW(this.S.localImageEntities));this.S.videoDownloadContextEntity&&D.push(this.S.videoDownloadContextEntity);return[].concat(g.xW(new Set(D)))};
g.U(AKK,dG);AKK.prototype.G=function(){return[]};
g.U(YUh,dG);YUh.prototype.G=function(){var D=[];this.S.fakeChildren&&D.push.apply(D,g.xW(this.S.fakeChildren));return[].concat(g.xW(new Set(D)))};
g.U(lXK,dG);lXK.prototype.G=function(){var D=[];this.S.video&&D.push(this.S.video);this.S.playbackData&&D.push(this.S.playbackData);this.S.offlineVideoPolicy&&D.push(this.S.offlineVideoPolicy);return[].concat(g.xW(new Set(D)))};
g.U(JKh,dG);JKh.prototype.G=function(){return[]};
g.U(xhy,dG);xhy.prototype.G=function(){var D=[];this.S.channelOwner&&D.push(this.S.channelOwner);this.S.videos&&D.push.apply(D,g.xW(this.S.videos));this.S.collaboratorChannels&&D.push.apply(D,g.xW(this.S.collaboratorChannels));this.S.downloadState&&D.push(this.S.downloadState);this.S.refresh&&D.push(this.S.refresh);return[].concat(g.xW(new Set(D)))};
g.U(Wyh,dG);Wyh.prototype.G=function(){var D=[];this.S.video&&D.push(this.S.video);this.S.channelContributor&&D.push(this.S.channelContributor);return[].concat(g.xW(new Set(D)))};
g.U(GXb,vV);GXb.prototype.G=function(){var D=[];this.S.localImageEntities&&D.push.apply(D,g.xW(this.S.localImageEntities));this.S.videoDownloadContextEntity&&D.push(this.S.videoDownloadContextEntity);return[].concat(g.xW(new Set(D)))};
g.U(z8B,vV);z8B.prototype.G=function(){var D=[];this.S.recommendedVideoMetadata&&D.push.apply(D,g.xW((new GXb(this.S.recommendedVideoMetadata)).G()));return[].concat(g.xW(new Set(D)))};
g.U(kXZ,vV);kXZ.prototype.G=function(){var D=[];this.S.playbackPosition&&D.push(this.S.playbackPosition);return[].concat(g.xW(new Set(D)))};
g.U(umG,dG);umG.prototype.G=function(){var D=[];this.S.owner&&D.push(this.S.owner);this.S.downloadState&&D.push(this.S.downloadState);this.S.userState&&D.push.apply(D,g.xW((new kXZ(this.S.userState)).G()));this.S.additionalMetadata&&D.push.apply(D,g.xW((new z8B(this.S.additionalMetadata)).G()));return[].concat(g.xW(new Set(D)))};
g.U(jqZ,dG);jqZ.prototype.G=function(){var D=[];this.S.userChannelDetails&&D.push(this.S.userChannelDetails);return[].concat(g.xW(new Set(D)))};
g.U(Dga,dG);Dga.prototype.G=function(){var D=[];this.S.channelOwner&&D.push(this.S.channelOwner);this.S.playbackPosition&&D.push(this.S.playbackPosition);this.S.localImageEntities&&D.push.apply(D,g.xW(this.S.localImageEntities));this.S.downloadStatus&&D.push(this.S.downloadStatus);return[].concat(g.xW(new Set(D)))};
g.U(XRn,dG);XRn.prototype.G=function(){return[]};
g.U(MjZ,dG);MjZ.prototype.G=function(){return[]};
g.U(Q5K,dG);Q5K.prototype.G=function(){return[]};
g.U(hA_,dG);hA_.prototype.G=function(){return[]};
g.U(HJZ,dG);HJZ.prototype.G=function(){return[]};
g.U(tjb,dG);tjb.prototype.G=function(){return[]};
g.U(Nin,dG);Nin.prototype.G=function(){return[]};
g.U(qS8,dG);qS8.prototype.G=function(){return[]};
g.U(wRr,dG);wRr.prototype.G=function(){return[]};
g.U(TiB,dG);TiB.prototype.G=function(){return[]};
g.U(LJr,dG);LJr.prototype.G=function(){return[]};
g.U(s5b,dG);s5b.prototype.G=function(){return[]};
g.U(KJW,dG);KJW.prototype.G=function(){return[]};
g.U(aOt,dG);aOt.prototype.G=function(){var D=[];this.S.compositeSourceKeys&&D.push.apply(D,g.xW(this.S.compositeSourceKeys));return[].concat(g.xW(new Set(D)))};
g.U(FJ8,dG);FJ8.prototype.G=function(){var D=[];this.S.trackDownloadMetadatas&&D.push.apply(D,g.xW(this.S.trackDownloadMetadatas));return[].concat(g.xW(new Set(D)))};
g.U(VjG,dG);
VjG.prototype.G=function(){var D=[];this.S.downloadedTracks&&D.push.apply(D,g.xW(this.S.downloadedTracks));this.S.smartDownloadedTracks&&D.push.apply(D,g.xW(this.S.smartDownloadedTracks));this.S.downloadedEpisodes&&D.push.apply(D,g.xW(this.S.downloadedEpisodes));this.S.downloadedAlbumReleases&&D.push.apply(D,g.xW(this.S.downloadedAlbumReleases));this.S.smartDownloadedAlbumReleases&&D.push.apply(D,g.xW(this.S.smartDownloadedAlbumReleases));this.S.downloadedPlaylists&&D.push.apply(D,g.xW(this.S.downloadedPlaylists));this.S.smartDownloadedPlaylists&&
D.push.apply(D,g.xW(this.S.smartDownloadedPlaylists));this.S.metadataOnlyTracks&&D.push.apply(D,g.xW(this.S.metadataOnlyTracks));return[].concat(g.xW(new Set(D)))};
g.U($ga,dG);$ga.prototype.G=function(){var D=[];this.S.trackDownloadMetadatas&&D.push.apply(D,g.xW(this.S.trackDownloadMetadatas));return[].concat(g.xW(new Set(D)))};
g.U(BiK,dG);BiK.prototype.G=function(){var D=[];this.S.playbackData&&D.push(this.S.playbackData);this.S.localImageEntities&&D.push.apply(D,g.xW(this.S.localImageEntities));this.S.videoDownloadContextEntity&&D.push(this.S.videoDownloadContextEntity);return[].concat(g.xW(new Set(D)))};
g.U(ZJ_,dG);ZJ_.prototype.G=function(){var D=[];this.S.musicLibraryStatusEntity&&D.push(this.S.musicLibraryStatusEntity);this.S.primaryArtists&&D.push.apply(D,g.xW(this.S.primaryArtists));this.S.details&&D.push(this.S.details);this.S.userDetails&&D.push(this.S.userDetails);this.S.tracks&&D.push.apply(D,g.xW(this.S.tracks));this.S.share&&D.push(this.S.share);this.S.downloadMetadata&&D.push(this.S.downloadMetadata);this.S.refresh&&D.push(this.S.refresh);return[].concat(g.xW(new Set(D)))};
g.U(UgB,dG);UgB.prototype.G=function(){var D=[];this.S.albumRelease&&D.push(this.S.albumRelease);this.S.tracks&&D.push.apply(D,g.xW(this.S.tracks));return[].concat(g.xW(new Set(D)))};
g.U(cTB,dG);cTB.prototype.G=function(){var D=[];this.S.albumRelease&&D.push(this.S.albumRelease);return[].concat(g.xW(new Set(D)))};
g.U(fOB,dG);fOB.prototype.G=function(){var D=[];this.S.details&&D.push(this.S.details);this.S.userDetails&&D.push(this.S.userDetails);return[].concat(g.xW(new Set(D)))};
g.U(SSC,dG);SSC.prototype.G=function(){var D=[];this.S.parentArtist&&D.push(this.S.parentArtist);return[].concat(g.xW(new Set(D)))};
g.U(Ecr,dG);Ecr.prototype.G=function(){var D=[];this.S.parentArtist&&D.push(this.S.parentArtist);return[].concat(g.xW(new Set(D)))};
g.U(yTB,dG);yTB.prototype.G=function(){return[]};
g.U(PFC,dG);PFC.prototype.G=function(){return[]};
g.U(mgC,vV);mgC.prototype.G=function(){var D=[];this.S.creatorEntity&&D.push(this.S.creatorEntity);return[].concat(g.xW(new Set(D)))};
g.U(nch,dG);
nch.prototype.G=function(){var D=[];this.S.tracks&&D.push.apply(D,g.xW(this.S.tracks));this.S.refresh&&D.push(this.S.refresh);this.S.musicLibraryStatusEntity&&D.push(this.S.musicLibraryStatusEntity);this.S.details&&D.push(this.S.details);this.S.downloadMetadata&&D.push(this.S.downloadMetadata);this.S.sideloadMetadata&&D.push(this.S.sideloadMetadata);this.S.userDetails&&D.push(this.S.userDetails);this.S.entryCollection&&D.push(this.S.entryCollection);this.S.share&&D.push(this.S.share);this.S.podcastShowAdditionalMetadata&&
D.push.apply(D,g.xW((new mgC(this.S.podcastShowAdditionalMetadata)).G()));return[].concat(g.xW(new Set(D)))};
g.U(bJh,dG);bJh.prototype.G=function(){return[]};
g.U(eAZ,dG);
eAZ.prototype.G=function(){var D=[];this.S.musicLibraryStatusEntity&&D.push(this.S.musicLibraryStatusEntity);this.S.artists&&D.push.apply(D,g.xW(this.S.artists));this.S.audioModeVersion&&D.push(this.S.audioModeVersion);this.S.videoModeVersion&&D.push(this.S.videoModeVersion);this.S.userDetails&&D.push(this.S.userDetails);this.S.details&&D.push(this.S.details);this.S.albumRelease&&D.push(this.S.albumRelease);this.S.share&&D.push(this.S.share);this.S.libraryEdit&&D.push(this.S.libraryEdit);this.S.downloadMetadata&&
D.push(this.S.downloadMetadata);this.S.playbackPosition&&D.push(this.S.playbackPosition);this.S.lyrics&&D.push(this.S.lyrics);return[].concat(g.xW(new Set(D)))};
g.U(RAn,dG);RAn.prototype.G=function(){var D=[];this.S.parentTrack&&D.push(this.S.parentTrack);return[].concat(g.xW(new Set(D)))};
g.U(IO8,dG);IO8.prototype.G=function(){var D=[];this.S.parentTrack&&D.push(this.S.parentTrack);return[].concat(g.xW(new Set(D)))};
g.U(gcG,dG);gcG.prototype.G=function(){return[]};
g.U(vcn,dG);vcn.prototype.G=function(){return[]};
g.U(dg8,dG);dg8.prototype.G=function(){return[]};
g.U(rTh,dG);rTh.prototype.G=function(){return[]};
g.U(iJa,dG);iJa.prototype.G=function(){var D=[];this.S.transfer&&D.push(this.S.transfer);this.S.adsPlaybackData&&D.push.apply(D,g.xW(this.S.adsPlaybackData));this.S.drmLicense&&D.push(this.S.drmLicense);this.S.offlineVideoPolicy&&D.push(this.S.offlineVideoPolicy);this.S.videoDownloadContextEntity&&D.push(this.S.videoDownloadContextEntity);return[].concat(g.xW(new Set(D)))};
g.U(ocb,dG);ocb.prototype.G=function(){return[]};
g.U(CFZ,dG);CFZ.prototype.G=function(){var D=[];this.S.offlineVideoStreams&&D.push.apply(D,g.xW(this.S.offlineVideoStreams));this.S.captionTrack&&D.push.apply(D,g.xW(this.S.captionTrack));return[].concat(g.xW(new Set(D)))};
g.U(OJB,dG);OJB.prototype.G=function(){return[]};
g.U(pRG,dG);pRG.prototype.G=function(){return[]};
g.U(ATZ,dG);ATZ.prototype.G=function(){return[]};
g.U(YSy,dG);YSy.prototype.G=function(){return[]};
g.U(lOr,dG);lOr.prototype.G=function(){return[]};
g.U(JTW,dG);JTW.prototype.G=function(){return[]};
g.U(xgZ,dG);xgZ.prototype.G=function(){return[]};
g.U(WJn,dG);WJn.prototype.G=function(){return[]};
g.U(GEB,dG);GEB.prototype.G=function(){return[]};
g.U(zAB,dG);zAB.prototype.G=function(){return[]};
g.U(kEh,dG);kEh.prototype.G=function(){return[]};
g.U(uab,dG);uab.prototype.G=function(){return[]};
g.U(j5_,dG);j5_.prototype.G=function(){return[]};
g.U(DoB,dG);DoB.prototype.G=function(){return[]};
g.U(XWh,dG);XWh.prototype.G=function(){return[]};
g.U(Mi_,dG);Mi_.prototype.G=function(){return[]};
g.U(Qmr,dG);Qmr.prototype.G=function(){return[]};
g.U(hdt,dG);hdt.prototype.G=function(){return[]};
g.U(Hph,dG);Hph.prototype.G=function(){return[]};
g.U(tin,dG);tin.prototype.G=function(){return[]};
g.U(Nyt,dG);Nyt.prototype.G=function(){return[]};
g.U(qXn,dG);qXn.prototype.G=function(){return[]};
var N4C=["browse","music/browse","streaming_browse","unplugged/browse"],s3G=["offline/playlist_sync_check"],u8y=["offline"],qsb=["offline/offline_video_playback_position_sync"],T4B=["offline/get_playback_data_entity"],rG;iV.getInstance=function(){return g.r(function(D){return D.return(new Promise(function(X){g.zh().then(function(M){M?(iV.instance||(iV.instance=new iV(M)),X(iV.instance)):X(void 0)})}))})};
iV.prototype.get=function(D){var X=this,M,Q,h;return g.r(function(H){if(H.S==1)return g.I(H,smW(X.token),2);if(H.S!=3)return M=H.G,g.I(H,M.get("prefs",D),3);Q=H.G;if(!Q)return H.return();h=(0,g.fi)();return Q.expirationTimestampMs<=h?H.return():H.return(Q.value)})};
iV.prototype.set=function(D,X,M){M=M===void 0?31536E3:M;var Q=this,h,H,t;return g.r(function(q){if(q.S==1)return h=(0,g.fi)(),H={key:D,value:X,expirationTimestampMs:h+M*1E3},g.I(q,smW(Q.token),2);t=q.G;return g.I(q,g.bD(t,"prefs",H),0)})};
iV.prototype.remove=function(D){var X=this,M;return g.r(function(Q){if(Q.S==1)return g.I(Q,smW(X.token),2);M=Q.G;return g.I(Q,M.delete("prefs",D),0)})};
g.U(oV,g.ys);g.U(Ch,$oG);Ch.prototype.Y=function(D,X){X=ZpG(X);D=(new TextEncoder).encode(JSON.stringify(D));return this.S.encrypt(D,X)};
Ch.prototype.G=function(D,X){if(!(D instanceof Uint8Array))throw Kry(1);var M=new TextDecoder;X=ZpG(X);D=this.S.decrypt(D,X);return JSON.parse(M.decode(D))};
var Uo_={accountLinkStatusEntity:e88,booleanEntity:cKr,buttonEntity:XWh,captionTrack:gcG,channelHandle:BQ8,chipEntity:xgZ,commerceAcquisitionClientPayloadEntity:Qmr,commerceCartListEntity:hdt,compositeSourceEntity:KJW,multiviewStagingEntity:aOt,contextNoteFeedEntityPayload:Z1h,contextNoteUserRatingEntityPayload:Uhh,continuationTokenEntity:JKh,downloadQualityPickerEntity:vXh,downloadsPageRefreshTokenEntity:rKK,downloadsPageViewConfigurationEntity:XRn,downloadStatusEntity:dhZ,dismissState:WJn,sfvAudioItemCurrentlyPlayingEntity:YSy,
emojiFountainDataEntity:j5_,emojiCustomizationSetEntity:uab,fakeChannel:SUa,fakePlaylist:EXC,fakePlaylistEntryCollection:PgW,fakeVideo:mh8,fakeVideoDescription:nXa,featuredProductsEntity:TiB,flowStateEntity:b1y,iconBadgeEntity:Hph,interstitialInteractionStateEntity:IXt,likeButtonAnimationEntity:MjZ,liveChatPollStateEntity:gXb,dataFreshnessEntity:kEh,liveViewerLeaderboardChatEntryPointStateEntity:pRG,liveViewerLeaderboardPointsEntity:ATZ,liveReactionsDataEntity:DoB,logoEntity:R8a,macroMarkerEntity:Q5K,
mainDownloadsLibraryEntity:i1h,mainDownloadsListEntity:CgG,mainPlaylistDownloadStateEntity:O1h,mainPlaylistEntity:xhy,mainPlaylistVideoEntity:Wyh,mainVideoDownloadStateEntity:phG,mainVideoEntity:umG,markersEngagementPanelSyncEntity:hA_,markersVisibilityOverrideEntity:HJZ,musicAlbumReleaseDetail:UgB,musicAlbumReleaseDownloadMetadataEntity:FJ8,musicAlbumRelease:ZJ_,musicAlbumReleaseUserDetail:cTB,musicArtistDetail:SSC,musicArtist:fOB,musicArtistUserDetail:Ecr,musicDownloadsLibraryEntity:VjG,musicLibraryEdit:yTB,
musicLibraryStatusEntity:PFC,musicPlaylist:nch,musicPlaylistDownloadMetadataEntity:$ga,musicShare:bJh,musicTrackDetail:RAn,musicTrackDownloadMetadataEntity:BiK,musicTrack:eAZ,musicTrackUserDetail:IO8,offlineOrchestrationActionWrapperEntity:vcn,offlineVideoPolicy:dg8,offlineVideoStreams:rTh,offlineabilityEntity:AKK,orchestrationWebSamplingEntity:YUh,pageHeaderEntity:GEB,pdpStateEntity:tin,pinnedProductEntity:LJr,playbackData:iJa,playerStateEntity:tjb,quantityIncrementerEntity:Nyt,refresh:ocb,saveToPlaylistListEntity:lOr,
selectedChipIndexEntityPayload:Nin,settingEntity:JTW,stringEntity:fXB,suggestedFeedbackChipStateEntity:qS8,transfer:CFZ,trendingOfferEntity:s5b,videoDownloadContextEntity:OJB,videoOverviewAsyncDataEntity:qXn,videoPlaybackPositionEntity:Mi_,votingEntity:zAB,ytMainChannelEntity:jqZ,youchatPendingResponseEntity:wRr,ytMainDownloadedVideoEntity:lXK,ytMainVideoEntity:Dga};g.U(JJ,$oG);JJ.prototype.Y=function(D){return D};
JJ.prototype.G=function(D){if(D instanceof Uint8Array)throw Kry(0);return D};
g.U(xh,g.O);xh.prototype.observe=function(D){var X=this;this.observers.push(D);return function(){var M=X.observers.indexOf(D);M>=0&&X.observers.splice(M,1)}};
xh.prototype.G=function(D){vGb(this,D.data)};
xh.prototype.Yy=function(){this.channel.close()};
var CGy,iPn=new g.bq("elementsCommand");var ft=new g.bq("entityBatchUpdate");var y2y=new g.bq("downloadStatusEntity");var Osh=new g.bq("mainPlaylistEntityActionMetadata");var W6=new g.bq("mainVideoEntityActionMetadata");var keW=new g.bq("musicPlaylistEntityActionMetadata");var cpG=new g.bq("musicTrackEntityActionMetadata");var MRG=new g.bq("localImageEntityActionMetadata");var gW=new g.bq("playbackDataActionMetadata");var imK=new g.bq("transferEntityActionMetadata");var SsZ=new g.bq("videoPlaybackPositionEntityActionMetadata");var XSC;new g.wh;new g.wh;tnK.prototype.request=function(D,X,M){X=X===void 0?{}:X;return this.locks.request(D,X,function(Q){return M(Q)})};var XK=g.E8.caches,Dy,LdW;jG.prototype.open=function(D){return XK.open(wSb(D))};
jG.prototype.has=function(D){return XK.has(wSb(D))};
jG.prototype.delete=function(D){return XK.delete(wSb(D))};
jG.prototype.match=function(D,X){var M=this,Q,h,H,t,q,w;return g.r(function(T){switch(T.S){case 1:return g.I(T,M.keys(),2);case 2:Q=T.G,h=g.e(Q),H=h.next();case 3:if(H.done){T.D4(5);break}t=H.value;return g.I(T,M.open(t),6);case 6:return q=T.G,g.I(T,q.match(D,X),7);case 7:if(w=T.G)return T.return(w);H=h.next();T.D4(3);break;case 5:return T.return()}})};
g.U(q$B,jG);q$B.prototype.keys=function(){var D,X,M,Q,h,H,t,q,w;return g.r(function(T){if(T.S==1)return D=[],X=g.Jr("CacheStorage keys"),g.I(T,XK.keys(),2);M=T.G;Q=g.e(M);for(h=Q.next();!h.done;h=Q.next()){H=h.value;var L=H.indexOf(":");t=L===-1?{Uo:H}:{Uo:H.substring(0,L),datasyncId:H.substring(L+1)};q=t.Uo;w=t.datasyncId;w===X&&D.push(q)}return T.return(D)})};g.U(QT,g.O);QT.prototype.Y=function(D){this.api.ER("onOfflineOperationFailure",D.data)};
QT.prototype.U=function(D){this.api.publish("offlinetransferpause",D.data)};
QT.prototype.Yy=function(){var D;(D=this.S)==null||D.close();var X;(X=this.G)==null||X.close()};aTB.prototype.a6=function(){this.S&&H6(this)};
aTB.prototype.We=function(){this.G&&this.G.resolve();this.Y=this.S=!1;this.eH()};var Dma=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var vqG="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var J28="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.U(air,ec);air.prototype.G=function(D){return wW(D)?$Nh(this,D):Tu(D)?UNC(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};g.U(c7K,ec);c7K.prototype.G=function(D){return Tu(D)?fiW(this,D):EqC(D)?Edh(this,D):Lt(D)?y7h(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};g.B=P$a.prototype;g.B.xxf=function(D){var X=this,M,Q,h,H;return g.r(function(t){if(!g.x(D.state,128))return t.D4(0);M=D.state.QV;var q=(Q=M)==null?void 0:Q.errorCode,w=(h=M)==null?void 0:h.oy;H=q==="net.connect"&&w===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(q==null?0:q.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.I(t,X.aL(X.player.getVideoData().videoId,H),0)})};
g.B.aL=function(D,X){var M=this;return g.r(function(Q){if(Q.S==1){if(M.G)return Q.return();M.G=!0;return X==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(rW(M,D,!1,!0),Q.D4(0)):g.I(Q,dW(M,D),3)}g.ds(D,4);return g.I(Q,M.S.aL(X),0)})};
g.B.Gi=function(D){D.status===2?(D.status!==this.Y&&(cib(this.S),g.ds(D.videoId,2)),D.i7&&Ptn(this.S,D.videoId,D.i7)):D.status===4?(dW(this,D.videoId),this.aL(D.videoId,D.E3?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):D.status===1&&yiG(this.S);this.Y=D.status;this.api.ER("localmediachange",{videoId:D.videoId,status:D.status})};
g.B.UO=function(){var D=this,X;return g.r(function(M){if(M.S==1){if(D.G)return M.return();D.G=!0;X=D.player.getVideoData().videoId;return g.I(M,dW(D,X),2)}return g.I(M,D.S.UO(),0)})};
g.B.MO=function(D){switch(D){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.B.T=function(D){return this.api.W().T(D)};g.U(Iiy,ec);Iiy.prototype.G=function(D){return wW(D)?vdy(this,D):Tu(D)?dNC(this,D):EqC(D)?r7C(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};A7W.prototype.S=function(D,X){var M=D.action.actionMetadata.priority-X.action.actionMetadata.priority;M===0&&(D.S<X.S?M=-1:D.S>X.S&&(M=1));return M};g.U(io,g.O);io.prototype.Yy=function(){this.eH&&this.eH();g.O.prototype.Yy.call(this)};
io.prototype.createAction=function(D,X){var M=g.il(D.entityKey).entityType,Q=g.sB(16);return new VT(M,Q,D,X.actionId,X.rootActionId)};
io.prototype.R5=function(D){var X=this,M,Q,h,H,t,q,w,T,L;return g.r(function(K){if(K.S==1){if(X.H2())return K.return();Q=(M=D.offlineOrchestrationActionWrapperEntity)!=null?M:new Set;h=[];H=g.e(Q);for(t=H.next();!t.done;t=H.next())q=t.value,w=g.il(q),T=w.entityId,J7_(X.S,T)||h.push(q);return g.I(K,Q7B(X,h),2)}L=K.G;return g.I(K,MIW(X,L),0)})};
io.prototype.retry=function(){var D=this;return g.r(function(X){return g.I(X,hJG(D),0)})};tIG.prototype.Ra=function(D,X){X=X===void 0?!0:X;var M=this,Q,h,H,t,q,w,T,L;return g.r(function(K){switch(K.S){case 1:if(!M.S)return K.return();Q=[];h=g.lO(M.S.S,X);H=[];for(t={Eh:0};t.Eh<h.length;t={Eh:t.Eh},t.Eh++)q=h[t.Eh],w=M.S.Hu(q,"json3"),T=g.e6(w,{withCredentials:!0,format:"RAW"},3,500).then(function(a){return function(F){F={metadata:g.BU(h[a.Eh]),trackData:F.xhr.responseText};H.push(F)}}(t)).iB(function(a){MA("Caption fetch error",a)}),Q.push(T);
return g.I(K,$hC(Q),2);case 2:return g.N_(K,3),g.I(K,WrC(D,H),5);case 5:g.Ty(K,0);break;case 3:L=g.LG(K),MA("Caption DB transaction error",L),g.HZ(K)}})};g.U(oR,g.O);oR.prototype.Yy=function(){this.G&&this.G();g.O.prototype.Yy.call(this)};
oR.prototype.Y=function(D){var X=this,M,Q,h,H,t,q,w,T;return g.r(function(L){Q=(M=D.transfer)!=null?M:new Set;h=[];H=g.e(Q);for(t=H.next();!t.done;t=H.next())q=t.value,w=g.il(q),T=w.entityId,h.push(T);return h.length===0?L.return():g.I(L,wPt(X,h),0)})};g.U(aub,g.O);g.B=aub.prototype;g.B.Yy=function(){this.a5&&this.a5();this.sR.dispose();this.U.dispose();this.uj&&g.Qw(this.X.v1,this.uj);this.M5&&g.Qw(this.X.v1,this.M5);g.O.prototype.Yy.call(this)};
g.B.VVF=function(D){var X=this,M,Q,h;return g.r(function(H){switch(H.S){case 1:M=g.oL(D,"transfer");if(X.S&&M===X.S.key){rW(X.J,X.D,!0);X.U.stop();H.D4(0);break}return g.I(H,WV(X.G,{mode:"readwrite",d3:!0},function(t){return OR(t,M,"transfer").then(function(q){if(q&&q.transferState!=="TRANSFER_STATE_COMPLETE"&&q.transferState!=="TRANSFER_STATE_FAILED")return q.transferState="TRANSFER_STATE_PAUSED_BY_USER",Yh(t,q,"transfer").then(function(){return q})})}),3);
case 3:Q=H.G;if(!Q){H.D4(0);break}if(!D||!X.Y){H.D4(5);break}return g.I(H,sA(D,X.Y,X.G,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.I(H,pt(X,D),7);case 7:h=H.G,fTG({videoId:D,Qj:Q,offlineModeType:h}),g.HZ(H)}})};
g.B.K3H=function(){var D=this;if(this.S&&this.D){rW(this.J,this.D,!1);var X=this.S,M=(X==null?0:X.key)?g.il(X.key).entityId:"";M&&this.Y&&(new Promise(function(Q,h){sA(M,D.Y,D.G,"DOWNLOAD_STATE_PAUSED").catch(function(H){h(H)})})).catch(function(Q){MA("Download state setting error",Q)})}this.U.stop()};
g.B.TU=function(){this.S?$mt(this,this.S):OA(this)};
g.B.iU=function(D){var X=this;return g.r(function(M){switch(M.S){case 1:if(!X.S){M.D4(2);break}if(X.S.transferState==="TRANSFER_STATE_COMPLETE"||X.S.transferState==="TRANSFER_STATE_FAILED"||!D.transfer||!D.transfer.has(X.S.key)){M.D4(3);break}return g.I(M,zs(X.G,X.S.key,"transfer"),4);case 4:X.S=M.G;if(X.S){M.D4(3);break}return g.I(M,B3W(X),3);case 3:if(X.S)return M.return();case 2:return g.I(M,OA(X),0)}})};
g.B.aL=function(D,X){var M=this,Q,h,H,t,q;return g.r(function(w){switch(w.S){case 1:if(!M.S){AZ(M,"onTransferFailure: "+D);w.D4(2);break}Q=M.S;H=((h=Q)==null?0:h.key)?g.il(Q.key).entityId:"";a:switch(D){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var T=!1;break a;default:T=!0}return T&&mmb(M)?g.I(w,Yb(M,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.I(w,
n1Z(M,D),5);case 5:if(!H||!M.Y){w.D4(2);break}return g.I(w,sA(H,M.Y,M.G,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.I(w,pt(M,H),9);case 9:t=w.G;NA({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:H,Qj:Q,offlineModeType:t});if(!H||!M.Y){w.D4(2);break}return g.I(w,sA(H,M.Y,M.G,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Ct(M),q=OA(M,!0),X&&X(q),g.HZ(w)}})};
g.B.UO=function(D){var X=this,M,Q,h,H,t,q,w,T,L,K,a,F;return g.r(function(V){switch(V.S){case 1:if(!X.S){AZ(X,"onMaybeTransferStreamsExpired");V.D4(2);break}return mmb(X)?g.I(V,Yb(X,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.I(V,n1Z(X,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!X.Y){V.D4(2);break}M=X.S;h=((Q=M)==null?0:Q.key)?g.il(M.key).entityId:"";if(!h){V.D4(2);break}return g.I(V,sA(h,X.Y,X.G,"DOWNLOAD_STATE_FAILED"),2);case 9:return X.S||AZ(X,"onMaybeTransferStreamsExpiredRetryAttempting"),
H=X.S,q=((t=H)==null?0:t.key)?g.il(H.key).entityId:"",g.I(V,pt(X,q),10);case 10:return w=V.G,NA({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:q,Qj:H,offlineModeType:w}),T=nqr(),g.RO(T,gW,{isEnqueuedForExpiredStreamUrlRefetch:!0}),L=g.oL(q,"playbackData"),K={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:L,actionMetadata:T},a=B6(new VT("playbackData",q,K)),g.I(V,Gs(X.G,a,"offlineOrchestrationActionWrapperEntity"),2);case 2:Ct(X),F=OA(X,!0),
D&&D(F),g.HZ(V)}})};
var IwW={},bsG=(IwW.TRANSFER_STATE_TRANSFERRING=1,IwW.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,IwW);g.B=lo.prototype;g.B.vY=function(){return this.D.promise};
g.B.Xb=function(){if(this.G&&this.J)return this.D.promise;Iua(this).then(this.D.resolve).catch(this.D.reject);return this.D.promise};
g.B.Ak=function(D){var X={};return X.playbackData=new air(D,this.j,this.S),X.transfer=new Iiy(D,this.j),X.videoPlaybackPositionEntity=new c7K(D,this.j),X};
g.B.o7=function(){var D=this;return g.r(function(X){return D.G?g.I(X,F$W(D.G),0):X.D4(0)})};
g.B.JH=function(){var D=this,X,M;return g.r(function(Q){if(Q.S==1)return D.G||D.J?g.I(Q,D.vY(),2):Q.return();D.K!==void 0&&(g.ZS(D.K),D.K=void 0);D.U!==void 0&&(g.ZS(D.U),D.U=void 0);(X=D.G)==null||X.dispose();D.G=void 0;(M=D.J)==null||M.dispose();D.J=void 0;D.api.ER("onOrchestrationLostLeader");D.D=new g.wh;g.HZ(Q)})};
g.B.isOrchestrationLeader=function(){return this.Y.S};
g.B.Eb=function(){return g.r(function(D){return D.return(!1)})};
g.B.ov=function(D){var X=this.S;X.api.publish("offlinetransferpause",D);var M;(M=X.G)==null||M.postMessage(D)};
g.B.TU=function(D){var X,M;return g.r(function(Q){if(Q.S==1)return g.I(Q,uV(),2);X=Q.G;if(!X)return Q.return();M=g.oL(D,"transfer");return g.I(Q,WV(X,{mode:"readwrite",d3:!0},function(h){var H=OR(h,M,"transfer"),t=OR(h,g.oL(D,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Bc.all([H,t]).then(function(q){q=g.e(q);var w=q.next().value;var T=q.next().value;return w&&w.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(w.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Yh(h,w,"transfer").then(function(){NA({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:D,Qj:w,offlineModeType:T==null?void 0:T.offlineModeType});return g.Bc.resolve(null)})):g.Bc.resolve(null)})}),0)})};
g.B.Mp=function(D){D=D===void 0?43200:D;var X=this,M,Q,h,H,t,q,w,T;return g.r(function(L){if(L.S==1)return X.X.Yh()?g.I(L,uV(),2):L.return(g1t());if(L.S!=3){M=L.G;if(!M)return L.return([]);Q=Date.now()/1E3;return g.I(L,kh(M,"offlineVideoPolicy"),3)}h=L.G;H=[];t=g.e(h);for(q=t.next();!q.done;q=t.next())w=q.value,Number(w.lastUpdatedTimestampSeconds)+D<=Q&&(T=g.il(w.key).entityId,H.push(T));return H.length?L.return(JZ(X,H,X.eH,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):L.return([])})};
g.B.deleteAll=function(){return JZ(this,["!*$_ALL_ENTITIES_!*$"],this.eH,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.B.refreshAllStaleEntities=function(D){var X=this;return g.r(function(M){return M.S==1?g.I(M,X.Mp(D),2):M.return(M.G)})};
g.B.setUpPositionSyncInterval=function(D){var X=this;this.U!==void 0&&(g.ZS(this.U),this.U=void 0);var M=D!=null?D:864E5;this.U=g.$H(function(){X.tB(M)},M)};
g.B.tB=function(D){var X=this,M,Q,h,H,t,q;return g.r(function(w){switch(w.S){case 1:return g.N_(w,2),g.I(w,iV.getInstance(),4);case 4:M=w.G;if(!M)throw Error("prefStorage is undefined");return g.I(w,M.get("psi"),5);case 5:Q=w.G;H=((h=Q)==null?0:h.LT)?Number(Q.LT)/1E3:0;t=Date.now();if(!(H+D<=t)){w.D4(6);break}return g.I(w,JZ(X,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Ty(w,0);break;case 2:q=g.LG(w),MA("Offline manager error",q),
g.HZ(w)}})};
g.B.I7=function(){var D=this,X,M,Q,h,H,t,q;return g.r(function(w){if(w.S==1)return g.I(w,uV(),2);if(w.S!=3)return(X=w.G)?g.I(w,kh(X,"transfer"),3):w.return([]);M=w.G;Q=[];h=g.e(M);for(H=h.next();!H.done;H=h.next())t=H.value,t.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&t.key&&(q=g.il(t.key).entityId,Q.push(q));return w.return(dmC(D,Q))})};
g.B.Rc=function(){return g.r(function(D){return D.return([])})};
g.B.nx=function(){return g.r(function(D){g.HZ(D)})};
g.B.gE=function(){return g.r(function(D){g.HZ(D)})};g.U(riy,ec);riy.prototype.G=function(D){return wW(D)?Cth(this,D):Tu(D)?pPh(this,D):Lt(D)?AiK(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};
var xb=[10];g.U(W$h,ec);W$h.prototype.G=function(D){return wW(D)?kWt(this,D):Tu(D)?u2Z(this,D):Lt(D)?j7h(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};
var zJy=[10];g.U(XgC,ec);XgC.prototype.G=function(D){return Tu(D)?Q_t(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};g.U(hpn,lo);g.B=hpn.prototype;g.B.Ak=function(D){var X=lo.prototype.Ak.call(this,D);X.mainVideoEntity=new W$h(D,this.j,this.S);X.mainPlaylistEntity=new riy(D,this.j,this.S);X.mainDownloadsListEntity=new XgC(D,this.j,this.S);return X};
g.B.refreshAllStaleEntities=function(D,X){var M=this,Q,h,H,t,q,w,T,L,K,a,F;return g.r(function(V){switch(V.S){case 1:Q=[];if(!M.j.T("web_player_offline_playlist_auto_refresh")){V.D4(2);break}return g.I(V,HYW(M,D,X),3);case 3:Q=V.G;case 2:return g.I(V,iV.getInstance(),4);case 4:return h=V.G,g.I(V,(H=h)==null?void 0:H.get("sdois"),5);case 5:return t=V.G,g.I(V,(q=h)==null?void 0:q.get("lmqf"),6);case 6:w=V.G;if(!t){V.D4(7);break}L=Q;K=L.concat;return g.I(V,tRy(M,t,(T=w)!=null?T:"SD",D===0),8);case 8:Q=
K.call(L,V.G);case 7:return a=Q,F=a.concat,g.I(V,lo.prototype.refreshAllStaleEntities.call(M,D,X),9);case 9:return Q=F.call(a,V.G),V.return(Q)}})};
g.B.Eb=function(D){var X,M,Q,h,H,t,q,w;return g.r(function(T){if(T.S==1)return g.I(T,uV(),2);if(T.S!=3)return(X=T.G)?g.I(T,zs(X,g.Ir,"mainDownloadsListEntity"),3):T.return(!1);M=T.G;if((Q=M)==null?0:(h=Q.downloads)==null?0:h.length)for(H=g.oL(D,"mainVideoEntity"),t=g.e(M.downloads),q=t.next();!q.done;q=t.next())if(w=q.value,w.videoItem===H)return T.return(!0);return T.return(!1)})};
g.B.Rc=function(){var D=this,X,M,Q,h,H,t,q,w;return g.r(function(T){if(T.S==1)return g.I(T,uV(),2);if(T.S!=3)return(X=T.G)?g.I(T,kh(X,"downloadStatusEntity"),3):T.return([]);M=T.G;Q=[];h=g.e(M);for(H=h.next();!H.done;H=h.next())t=H.value,t.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&t.key&&(q=g.il(t.key).entityId,Q.push(q));return Q.length?(w={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},T.return(JZ(D,Q,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
w))):T.return([])})};
g.B.gE=function(){var D;return g.r(function(X){return X.S==1?g.I(X,uV(),2):(D=X.G)?g.I(X,WV(D,{mode:"readwrite",d3:!0},function(M){return ph(M,"mainVideoEntity").then(function(Q){var h=[];Q=g.e(Q);for(var H=Q.next();!H.done;H=Q.next()){H=H.value;var t=void 0;(t=H.userState)!=null&&t.playbackPosition||(t=g.il(H.key).entityId,t={key:g.oL(t,"videoPlaybackPositionEntity"),videoId:t,lastPlaybackPositionSeconds:"0"},h.push(Yh(M,t,"videoPlaybackPositionEntity")),H.userState={playbackPosition:t.key},h.push(Yh(M,
H,"mainVideoEntity")))}return g.Bc.all(h)})}),0):X.return()})};
g.B.nx=function(){var D,X,M,Q,h,H,t,q,w,T,L,K,a,F,V,c,S,b,n,R,v,l,A,Hs,u,D_,q5,Lo,Qs,S2,XC,q_,th,Jd,Gp,zy,Ra,m;return g.r(function($B){if($B.S==1)return g.I($B,uV(),2);if($B.S!=3){D=$B.G;if(!D)return $B.return();X=g.oL("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.I($B,WV(D,{mode:"readonly",d3:!0},function(WZ){return g.Bc.all([OR(WZ,X,"mainDownloadsListEntity"),OR(WZ,g.Ir,"mainDownloadsListEntity"),ph(WZ,"mainVideoEntity"),ph(WZ,"mainPlaylistEntity")])}),3)}M=$B.G;
Q=g.e(M);h=Q.next().value;H=Q.next().value;t=Q.next().value;q=Q.next().value;w=h;T=H;L=t;K=q;a=new Set;if((F=w)==null?0:(V=F.downloads)==null?0:V.length)for(c=g.e(w.downloads),S=c.next();!S.done;S=c.next())b=S.value,n=void 0,(R=(n=b.videoItem)!=null?n:b.playlistItem)&&a.add(R);if((v=T)==null?0:(l=v.downloads)==null?0:l.length)for(A=g.e(T.downloads),Hs=A.next();!Hs.done;Hs=A.next())u=Hs.value,u.videoItem&&a.add(u.videoItem);D_=new Set;q5=[];Lo=g.e(K);for(Qs=Lo.next();!Qs.done;Qs=Lo.next()){S2=Qs.value;
if(S2.videos)for(XC=g.e(S2.videos),q_=XC.next();!q_.done;q_=XC.next())th=q_.value,(Jd=JSON.parse(g.il(th).entityId).videoId)&&D_.add(Jd);S2.key&&!a.has(S2.key)&&q5.push(S2.key)}Gp=g.e(L);for(zy=Gp.next();!zy.done;zy=Gp.next())Ra=zy.value,Ra.key&&!a.has(Ra.key)&&(m=g.il(Ra.key).entityId,D_.has(m)||q5.push(Ra.key));return q5.length?g.I($B,pSn(D,q5),0):$B.D4(0)})};g.U(Nht,ec);Nht.prototype.G=function(D){return wW(D)?wgr(this,D):Tu(D)?Thh(this,D):Lt(D)?L__(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};
var Gu=[10];g.U(K_B,ec);K_B.prototype.G=function(D){return wW(D)?F_b(this,D):Tu(D)?VRh(this,D):Lt(D)?$6C(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};
var zu=[10];g.U(U6a,ec);U6a.prototype.G=function(D){return wW(D)?Epr(this,D):Tu(D)?ypy(this,D):Lt(D)?Prh(this,D):Promise.reject(Error("Unsupported action type: "+D.actionType))};
var Shb=[10];g.U(kb,lo);kb.prototype.Ak=function(D){var X=lo.prototype.Ak.call(this,D);X.musicTrack=new U6a(D,this.S);X.musicPlaylist=new K_B(D,this.S);X.musicAlbumRelease=new Nht(D,this.S);return X};
kb.prototype.refreshAllStaleEntities=function(D,X){var M=this,Q,h,H;return g.r(function(t){if(t.S==1)return g.I(t,npB(M,D,X),2);if(t.S!=3)return h=Q=t.G,H=h.concat,g.I(t,lo.prototype.refreshAllStaleEntities.call(M,D,X),3);Q=H.call(h,t.G);return t.return(Q)})};g.U(bYK,g.Tn);g.B=bYK.prototype;g.B.create=function(){var D=this;g.p(this,this.events);if(g.uS(this.j))this.S=new hpn(this.j,this.player);else if(g.RW(this.j)||g.Dk(this.j))this.S=new kb(this.j,this.player);this.events.N(this.player,"onPlaybackStartExternal",function(){D.yl()});
this.events.N(this.player,"videodatachange",function(){D.yl()});
this.j.T("html5_offline_playback_position_sync")&&this.events.N(this.player,"presentingplayerstatechange",this.Y3)};
g.B.Y8=function(){return!1};
g.B.oO=function(D,X,M,Q){var h=this;return g.r(function(H){return h.S?H.return(JZ(h.S,D,X,M,Q)):H.return(Promise.reject())})};
g.B.deleteAll=function(){return this.S.deleteAll()};
g.B.Mp=function(D){return this.S.Mp(D)};
g.B.refreshAllStaleEntities=function(D){return this.S.refreshAllStaleEntities(D)};
g.B.setUpPositionSyncInterval=function(D){this.S.setUpPositionSyncInterval(D)};
g.B.ov=function(D){this.S.ov(D)};
g.B.TU=function(D){return this.S.TU(D)};
g.B.yl=function(){var D=this,X;return g.r(function(M){X=D.player.getVideoData();return g.uf(X)?epZ(X)&&D.G!==X.clientPlaybackNonce?g.I(M,Rpb(D,X),0):M.D4(0):M.return()})};
g.B.Y3=function(D){var X=this,M,Q,h,H,t,q,w;return g.r(function(T){if(T.S==1)return M=X.player.getVideoData(),Q=M.Mj,g.qZ(D,2)||g.qZ(D,512)?g.I(T,uV(),2):T.return();if(T.S!=3){h=T.G;if(!h)return MA("PES is undefined"),T.return();H=M.videoId;return g.I(T,zs(h,g.oL(H,"mainVideoEntity"),"mainVideoEntity"),3)}t=T.G;if(!t)return T.return();q=Math.floor(Q).toString();w={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:q}};return g.I(T,X.oO([H],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
w),0)})};
g.B.isOrchestrationLeader=function(){return this.S.isOrchestrationLeader()};
g.B.updateDownloadState=function(D,X){var M,Q,h,H;return g.r(function(t){if(t.S==1)return g.I(t,uV(),2);M=t.G;if(!M)return MA("PES is undefined"),t.return();Q=g.il(D);h=Q.entityType;H=Q.entityId;return g.I(t,sA(H,h,M,X,!0),0)})};g.wZ("offline",bYK);})(_yt_player);
